/* Olark API documentation at: http://www.olark.com/docs and on http://blog.olark.com -- Copyright Habla Incorporated 2008 - 2010 -- looking for an internship?  jobs@olark.com */ hbl.hconfig.prototype.merge=function(c,a){this.copy_hash(this.vars,c.vars,a);this.copy_hash(this.style,c.style,a);this.copy_hash(this.palette,c.palette,a);this.copy_hash(this.style_id,c.style_id,a);this.copy_hash(this.style_classes,c.style_classes,a);this.copy_hash(this.style_classes_map,c.style_classes_map,a);if(c.plugins&&c.plugins.todo){for(var b in c.plugins.todo){this.plugins.add(c.plugins.todo.handler,c.plugins.todo.priority)}}};hbl.hconfig.prototype.copy_hash=function(c,a,b){if(!a){return}for(var d in a){if(b||c[d]==undefined){c[d]=a[d]}}};hbl.hconfig.prototype.up=function(a){this.merge(a,true)};hbl.hconfig.prototype.render_all_styles=function(a){var b;for(var b in this.style_classes_map){if(typeof(b)=="string"&&a[b]){this.render_element_classes(a,b)}}};hbl.hconfig.prototype.render_stylesheet=function(c){hbl.util.css.create_css_class("div#habla_window_div p","padding:0;");for(var b in this.style_classes){var a=this.render_part(this.style_classes[b]);hbl.util.css.create_css_class("."+b,a)}};hbl.hconfig.prototype.smart_join=function(a,c){var b="";for(var d in a){if(typeof(a[d])=="string"){b+=a[d]+c}}return b};hbl.hconfig.prototype.render_element_classes=function(a,b){this.set_element_classes(a[b],b)};hbl.hconfig.prototype.set_element_classes=function(b,a){if(b&&this.style_classes_map[a]&&this.style_classes_map[a].join){b.className=this.smart_join(this.style_classes_map[a]," ")}else{}};hbl.hconfig.prototype.render_element=function(a,b){this.render_element_classes(a,b)};hbl.hconfig.prototype.render_class=function(f,d,c){if(!f){return}if(!f.className){return}var e=f.className.split(" ");var a=[];for(var b in e){if(typeof(b)=="string"){if(e[b]!=c&&e[b]!=d){a.push(e[b])}}}a.push(d);f.className=this.smart_join(a," ")};hbl.hconfig.prototype.render_ie_hacks=function(){if((hbl.util.BrowserDetect.backwards_position&&!this.vars.is_inline)||this.vars.yahoo_ui){if(!window.hbl.__ie6_floating_div_monitor){window.hbl.__ie6_floating_div_monitor=new window.__ie6_float_hack()}}};hbl.hconfig.prototype.remap_palette=function(){var b={mainbg:"main_bg",mainfg:"main_fg",titlebg:"title_bg",titlefg:"title_fg",buttonbg:"button_bg",buttonfg:"button_fg",buttonhi:"button_bg_highlight",titlebg_highlight:"title_bg_highlight",titlefg_highlight:"title_fg_highlight",control:"control_border",control_highlight:"control_highlight_border",local:"local_fg",remote:"remote_fg",border:"panel_border"};for(var a in b){if(typeof(a)!="string"){continue}if(this.palette[a]){this.palette[b[a]]=this.palette[a]}}if(this.palette.buttonfg){this.palette.button_fg_highlight=this.palette.buttonfg}};hbl.hconfig.prototype.init_from_config=function(a){a.setWidth(this.vars.width);a.setHeight(this.vars.height);if(!this.vars.is_inline){a.setPosition(this.vars.corner_position)}else{a.setInline(this.vars.is_inline)}a.setMargins(this.vars.left_margin,this.vars.top_margin,this.vars.right_margin,this.vars.bottom_margin);a.setInputHeight(this.vars.input_height);a.setFormInputHeight(this.vars.input_height);if(hbl.util.BrowserDetect.browser=="Opera"){this.vars.poll=true}};hbl.hconfig.prototype.load_defaults=function(){this.plugins=new hbl.util.pluginlist();this.vars=new Array();this.palette={};this.palette.link="#e75917";this.vars.line_length=21;this.vars.bottom_margin=10;this.vars.right_margin=10;this.vars.left_margin=10;this.vars.top_margin=10;this.vars.width=260;this.vars.height=155;this.vars.panel_offset=20;this.vars.resize_input_height=60;this.vars.input_height=20;this.vars.corner_position="BR";this.vars.rtl=false;this.vars.resize_length=25;this.vars.myname="you";this.vars.say_text="Type here and hit <enter> to chat";this.vars.send_text="Send";this.vars.check_for_status=hblName+" (startup)";this.vars.disable_expand_text_input=false;this.vars.disable_set_cookies=false;this.vars.disable_get_cookies=false;this.vars.cookie_path="/";this.vars.hbl_cookie_path="/";this.vars.session_expire=undefined;this.vars.local_user_display_name="&gt;";this.vars.disableGoogleAnalytics=0;this.vars.expandOnMessageReceived=0;this.vars.enable_google_analytics=true;this.vars.google_analytics_domain="auto";this.vars.language="en";this.vars.enableLanguageTranslation=false;this.vars.expandOnFirstMessageReceived=1;this.vars.close_hides_window=false;this.vars.plugin_path=hblStaticPath+"/plugins/";this.vars.divid="habla_window_div";this.vars.poll=false;if(hbl.util.BrowserDetect.browser=="Opera"){this.vars.poll=true}this.vars.auto_initiate_notify_msg="(sent auto initiated message)";this.vars.auto_initiate_notify=false;this.vars.auto_initiate_response_notify="(Responded to auto initiation)";this.vars.auto_initiate_allowed=false;this.vars.auto_initiate=false;this.vars.auto_initiate_period=10;this.vars.auto_initiate_name=">";this.vars.auto_initiate_message=["hi"];this.vars.habla_name_input_text="<click here> and type your Name";this.vars.habla_offline_email_text="<click here> and type your Email";this.vars.habla_offline_body_text="We are offline, send us a message";this.vars.habla_offline_submit_value="Send";this.vars.habla_offline_sent_text="Thank you for your message.  We will get back to you as soon as we can.";this.vars.in_chat_text="Live Help: Now Chatting";this.vars.before_chat_text="Click for Live Help";this.vars.not_available_text="Live Help: Offline";this.vars.busy_text="Live Help: Unavailable";this.vars.away_text="Live Help: Unavailable";this.vars.offline_message="Our live support feature is currently offline. Please try again later.";this.vars.welcome_msg="Questions? This window is your portal to live online support. We are around, send us a message.";this.vars.busy_message="All of our representatives are with other customers at this time. We will be with you shortly.";this.vars.enable_buttons=1;this.vars.hide_min_max_buttons=0;this.vars.local_name_override=undefined;this.vars.url_handler_target_window="_top";this.vars.url_handler=hblUrlHandler;this.vars.url_local_pattern=document.domain;this.vars.parse_links=1;this.vars.is_inline=0;this.vars.start_expanded=0;this.vars.start_hidden=0;this.vars.hide_not_available=0;this.vars.append_to_body=1;this.vars.show_away=0;this.vars.hide_when_away=0;this.vars.show_away_as_header=0;this.vars.habla_sizebutton_text_expanded="_";this.vars.habla_sizebutton_text_compressed="^";this.vars.habla_closebutton_text="x";this.vars.habla_popout_text=">";this.vars.habla_end_popout_text="&lt;&lt;";this.vars.start_visible=false;this.vars.start_habla_window_visible=false;this.vars.pre_chat_message="Hi, I am around, click 'start chatting' to contact me.";this.vars.pre_chat_submit="Click here to start chatting";this.vars.pre_chat_error_text="Please enter your name and email in case we get disconnected.";this.vars.show_pre_chat=0;this.vars.require_name=2;this.vars.require_email=1;this.vars.require_phone=0;this.vars.show_end_popout=0;this.vars.show_popout=0;this.vars.is_popup=0;this.vars.sending_text="sending";this.vars.email_body_error_text="Complete all fields";this.vars.habla_special_div_show_type="block";this.vars.flash_icons=1;this.vars.flash_titlebar=1;this.vars.default_flash_off_icon=hblStaticPath+"/images/white.ico";this.vars.default_flash_on_icon=hblStaticPath+"/images/orange.ico";this.style_classes_map={};this.style_id={};this.style_classes={};this.style=new Array();this.style.habla_link_a="font-family: verdana, sans-serif; text-transform: uppercase; font-size: 9px; letter-spacing: 2px; font-weight: bold; color: #E75917"};window.hbl.__ie6_floating_div_monitor=undefined;window.__ie6_float_hack=function(){var a=this;a.__moving=false;a.__need_to_move=function(){var b=a.__with_complete_habla_window(function(f){var d=f.config.get_ie_position(f);if(f.theme){var e={x:f.theme.getX(),y:f.theme.getY()};var h=d.x-e.x;var g=d.y-e.y;var c=Math.max(Math.abs(h),Math.abs(g));return{x:h,y:g,max_diff:c}}else{return{x:0,y:0,max_diff:0}}});if(b){return b}else{return{x:0,y:0,max_diff:0}}};a.__with_complete_habla_window=function(b){var c=window.habla_window;if(c&&c.config&&c.config.vars&&c.config.vars.corner_position){return b(c)}return undefined};a.__move_window=function(c,b){a.__with_complete_habla_window(function(d){var e=d.config.get_ie_position(d);d.theme.setXY(e.x-c,e.y-b)})};a.__check_location=function(){a.__move_to_correct_location();setTimeout(function(){a.__check_location()},500)};a.__move_to_correct_location=function(c){var b=a.__need_to_move();if(!c&&b.max_diff<2){return}else{if(c||b.max_diff<15){a.__move_window(0,0)}else{a.__move_window(b.x*0.5,b.y*0.5);setTimeout(function(){a.__move_to_correct_location()},40)}}};a.stop=function(){if(a.__timeout){clearTimeout(a.__timeout)}a.__timeout=undefined};a.start=function(){a.stop();a.__timeout=setTimeout(function(){a.__check_location()},500)};a.__move_to_correct_location(true);a.start()};hbl.hconfig.prototype.get_ie_position=function(a){var c=0;var b=0;if(this.vars.corner_position.match("R")){c=-this.vars.right_margin-a.theme.habla_window_div.offsetWidth+(document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth)+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft)}else{c=this.vars.left_margin+(document.documentElement.scrollRight?document.documentElement.scrollRight:document.body.scrollRight)}if(this.vars.corner_position.match("B")){b=-this.vars.bottom_margin-a.theme.habla_window_div.offsetHeight+(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight)+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)}else{b=this.vars.top_margin+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)}if(!b){b=this.vars.top_margin}if(!c){c=this.vars.top_margin}return({x:c,y:b})};hbl.util.pluginlist.prototype.load=function(a){var b=a;for(var c=0;c<this.todo.length;c++){if(this.todo[c]&&this.todo[c]["handler"]&&typeof(this.todo[c]["handler"]["load"])=="function"&&this.defined[this.todo[c]["handler"].name]==1){this.todo[c]["handler"].load(a);this.defined[this.todo[c]["handler"].name]=2}}return b};hbl.util.last_js_id=0;hbl.util.pipeline=function(a){this.todo=new Array();this.host_obj=a;this.add=function(c,b){if(b==undefined){b=999}this.todo.push({handler:c,priority:b});this.todo=this.todo.sort(function(e,d){return(e.priority-d.priority)})};this.run=function(b){var c=b;for(var d=0;d<this.todo.length;d++){if(this.todo[d]&&typeof(this.todo[d]["handler"])=="function"){c=this.todo[d]["handler"](b,this.host_obj);if(c==undefined){return undefined}b=c}}return c};this.setTarget=function(b){this.host_obj=b}};hbl.util.pluginloader=function(c,a,b){hbl.pluginArgs={conf:c,client:a,hwindow:b};c.plugins.load({conf:c,client:a,hwindow:b})};hbl.util.timestamp=function(){var a=new Date();return a.toUTCString()};hbl.util.reportException=function(a){};hbl.util.set_cookie=function(f){var e=escape(f.value);var g=f.path||"/";var a=f.name+"="+e+"; path="+g+";";var c=f.expire;if(c!=undefined){var h=new Date();h.setTime(h.getTime()+c);var b=h.toGMTString();a=a+"expires="+b+";"}if(f.extra!=undefined){a+=f.extra}document.cookie=a};hbl.util.get_cookie=function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null};hbl.util.urlencode=function(a){var c="";for(var b in a){c+=b+"="+encodeURI(a[b])+"&"}return c};hbl.util.load_js_async=function(a){hbl.util.last_js_id+=1;var c="jscript"+hbl.util.last_js_id;if(a.indexOf("?")>-1){a+="&"+c}else{a+="?"+c}if(hbl.util.last_js_id>1900){if(a.match(/sendmessage/i)||a.match(/begin/i)){hbl.util.last_js_id=1}else{return}}html_doc=hbl.util.get_body();var b=document.createElement("script");b.setAttribute("language","javascript");b.setAttribute("id",c);b.setAttribute("type","text/javascript");b.setAttribute("src",a);html_doc.appendChild(b)};hbl.util.remove_element=function(a){var b=document.getElementById(a);if(b!=undefined&&b.parentNode!=undefined){b.parentNode.removeChild(b)}};hbl.util.append_script=function(f){var b=hbl.util.append_script;var n=f.scriptid;var c=f.url;var m=f.tries;var k=f.timeout;var g=f.error_callback;var a=f.cache;var h=100;var e=800;var j="timeout";var i=function(){var p=document.getElementById(n);if(p){if(p.parentNode!=undefined){p.parentNode.removeChild(p)}else{}if(g){g({status:j})}if(m>0){c=c.replace(n+"&",n+"r"+m+"&");setTimeout(function(){b({scriptid:n+"r"+m,url:c,tries:m,timeout:k,error_callback:g,cache:a})},e)}}else{}};var l=c;if(!a){if(l.match(/\?/)){l+="?"}else{l+="&"}l+="&_rnd="+Math.random()}var d=document.createElement("script");d.setAttribute("language","javascript");d.setAttribute("id",n);d.setAttribute("type","text/javascript");d.setAttribute("src",l);d.loaded=false;if(m){m=m-1}if(k){j="timeout";d.timeout=setTimeout(i,k)}if(d.readyState){d.onreadystatechange=function(){if((d.readyState=="loaded"||d.readyState=="complete")&&!d.loaded){d.onreadystatechange=function(){};d.loaded=true;if(d.timeout){clearTimeout(d.timeout)}j="error";setTimeout(i,h)}}}else{d.onload=function(){if(!d.loaded){d.loaded=true;if(d.timeout){clearTimeout(d.timeout)}j="error";setTimeout(i,h)}};d.onerror=function(){if(!d.loaded){d.loaded=true;if(d.timeout){clearTimeout(d.timeout)}j="error";setTimeout(i,h)}}}var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(d,o)};hbl.util.as_dom=function(b){var a;if(typeof(b)=="object"){return b}a=document.createElement("span");a.innerHTML=b;return a};hbl.util.find_or_create_el=function(a,c,d){var b=document.getElementById(a);if(!b||b.length<0){if(c==undefined){c="div"}b=document.createElement(c);b.setAttribute("id",a);if(d!=undefined){d.appendChild(b)}}return b};hbl.util.find_or_create_div=function(b,a){return hbl.util.find_or_create_el(b,"div",a)};hbl.util.hide_div=function(a){if(typeof(a)!="object"){a=document.getElementById(a)}if(a!=undefined){a.style.display="none";return true}return false};hbl.util.show_div=function(b,a){if(a==undefined){a="block"}if(typeof(b)!="object"){b=document.getElementById(b)}if(b!=undefined){b.style.display=a;return true}return false};hbl.util.clean_whitespace=function(a){a=a.replace(/^\s*/,"");a=a.replace(/\s*$/,"");a=a.replace("'","");return a};hbl.util.decode_base64=function(input,eval_it){var output="";if(window.atob){output=window.atob(input)}else{var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{enc1=keyStr.indexOf(input.charAt(i++));enc2=keyStr.indexOf(input.charAt(i++));enc3=keyStr.indexOf(input.charAt(i++));enc4=keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}while(i<input.length)}if(eval_it){var output1;eval("output1 = "+output);return output1}return output};hbl.util.encode_base64=function(h){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var c,b,a,m,l,k,j,n,g=0,o=0,f="",e=[];if(!h){return h}h=hbl.util.utf8_encode(h+"");do{c=h.charCodeAt(g++);b=h.charCodeAt(g++);a=h.charCodeAt(g++);n=c<<16|b<<8|a;m=n>>18&63;l=n>>12&63;k=n>>6&63;j=n&63;e[o++]=d.charAt(m)+d.charAt(l)+d.charAt(k)+d.charAt(j)}while(g<h.length);f=e.join("");switch(h.length%3){case 1:f=f.slice(0,-2)+"==";break;case 2:f=f.slice(0,-1)+"=";break}return f};hbl.util.utf8_encode=function(d){d=(d+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var b="";var h,a;var f=0;h=a=0;f=d.length;for(var g=0;g<f;g++){var e=d.charCodeAt(g);var c=null;if(e<128){a++}else{if((e>127)&&(e<2048)){c=String.fromCharCode((e>>6)|192)+String.fromCharCode((e&63)|128)}else{c=String.fromCharCode((e>>12)|224)+String.fromCharCode(((e>>6)&63)|128)+String.fromCharCode((e&63)|128)}}if(c!==null){if(a>h){b+=d.substring(h,a)}b+=c;h=a=g+1}}if(a>h){b+=d.substring(h,d.length)}return b};hbl.util.css={};hbl.util.getElementsByClass=function(g,h){if(!g){g=document.getElementsByTagName("body")[0]}var b=[];var f=new RegExp("\\b"+h+"\\b");var e=g.getElementsByTagName("*");for(var d=0,c=e.length;d<c;d++){if(f.test(e[d].className)){b.push(e[d])}}return b};hbl.client={incoming_pipeline:new hbl.util.pipeline(),first_time:true,pollingmanager:{LAG_CONSTANT:25*1000,GET_MESSAGES_TIMEOUT:55*1000,ACTIVE_CHAT:70*1000,RECENTLY_ACTIVE_CHAT:120*1000,FIRST_POLL_TIME:0.8*1000,RECENTLY_ACTIVE_CHAT_TIMEOUT:25*1000,IGNORE_LAG_TIME:10*1000,MAX_POLL_TIME:120*60*1000,check_failed_polling_rate:20*1000,THROTTLE_THRESHOLD_MESSAGE:5*60*1000,LAST_ACTION_THROTTLE_THRESHOLD:1*1000,LAST_ACTION_THROTTLE_MIN:2*1000,last_poll_start_time:0,last_poll_end_time:0,first_poll_time:0,last_action_time:0,last_sent_message_time:0,next_poll_time:0,current_poll_rate:0,check_for_failed_timer:false,last_poll_timer:false,event_driven:false,expected_finish:0,rate_array:false,build_rates:function(){if(hbl.client.pollingmanager.rate_array!=false){return}hbl.client.pollingmanager.rate_array=[{last_action:0,time_on_page:4*60*1000,timeout:45*1000,opavailable:false},{last_action:0,time_on_page:2*60*60*1000,timeout:25*60*1000,opavailable:false},{polling:false,last_action:70*1000,time_on_page:0,timeout:0,opavailable:true},{polling:true,last_action:5*1000,time_on_page:0,timeout:600,opavailable:true},{polling:true,last_action:15*1000,time_on_page:0,timeout:800,opavailable:true},{polling:true,last_action:30*1000,time_on_page:0,timeout:1500,opavailable:true},{polling:true,last_action:60*1000,time_on_page:0,timeout:3*1000,opavailable:true},{polling:true,last_action:90*1000,time_on_page:0,timeout:10*1000,opavailable:true},{last_action:0,time_on_page:2*60*1000,timeout:3*1000,opavailable:true},{last_action:0,time_on_page:5*60*1000,timeout:10*1000,opavailable:true},{last_action:0,time_on_page:15*60*1000,timeout:27*1000,opavailable:true},{last_action:0,time_on_page:45*60*1000,timeout:45*1000,opavailable:true},{last_action:0,time_on_page:2*60*60*1000,timeout:2*60*1000,opavailable:true},{last_action:0,time_on_page:8*60*60*1000,timeout:15*60*1000,opavailable:true},{last_action:0,time_on_page:24*60*60*1000,timeout:30*60*1000,opavailable:true}]},get_rate:function(c,j,b,h){var a=new Date();var g=-1;if(hbl.client.pollingmanager.first_poll_time==0&&hbl.client.pollingmanager.rate_array==false){hbl.client.pollingmanager.build_rates();return hbl.client.pollingmanager.FIRST_POLL_TIME}if(b){return hbl.client.pollingmanager.MAX_POLL_TIME}var k=a.getTime()-hbl.client.pollingmanager.first_poll_time;var e=a.getTime()-hbl.client.pollingmanager.last_action_time;if(e<hbl.client.pollingmanager.LAST_ACTION_THROTTLE_THRESHOLD&&a.getTime()-hbl.client.pollingmanager.last_sent_message_time>hbl.client.pollingmanager.THROTTLE_THRESHOLD_MESSAGE){e=hbl.client.pollingmanager.LAST_ACTION_THROTTLE_MIN}var d=hbl.client.pollingmanager.rate_array;for(var f in d){if((d[f]["polling"]==h||d[f]["polling"]==undefined)&&d[f]["opavailable"]==c&&(d[f]["passive_mode"]==undefined||d[f]["passive_mode"]==b)&&(d[f]["time_on_page"]>k||d[f]["last_action"]>e)){return d[f]["timeout"]}}return hbl.client.pollingmanager.MAX_POLL_TIME},start_next_poll:function(c,d,g,e,f){if(hbl.client.pollingmanager.check_for_failed_timer==false){hbl.client.pollingmanager.check_for_failed_timer=setTimeout("hbl.client.pollingmanager.check_failed_polling()",hbl.client.pollingmanager.check_failed_polling_rate)}var b=hbl.client.pollingmanager.get_rate(c,d,e,g);hbl.client.pollingmanager.current_poll_rate=b;var a=new Date();if(hbl.client.pollingmanager.next_poll_time>a.getTime()&&hbl.client.pollingmanager.next_poll_time<a.getTime()+b){}else{if(hbl.client.pollingmanager.last_poll_timer!=false){window.clearTimeout(hbl.client.pollingmanager.last_poll_timer)}hbl.client.pollingmanager.next_poll_time=a.getTime()+b;if(b==0){hbl.client.pollingmanager.expected_finish=hbl.client.pollingmanager.GET_MESSAGES_TIMEOUT+a.getTime()}else{hbl.client.pollingmanager.expected_finish=hbl.client.pollingmanager.next_poll_time+hbl.client.pollingmanager.LAG_CONSTANT}hbl.client.pollingmanager.last_poll_timer=window.setTimeout("hbl.client.pollingmanager.pollfunc("+(f==true?"true":"")+")",b)}},pollfunc:function(a){var c=new Date();hbl.client.pollingmanager.last_poll_start_time=c.getTime();if(hbl.client.pollingmanager.current_poll_rate==0){hbl.client.pollingmanager.expected_finish=hbl.client.pollingmanager.GET_MESSAGES_TIMEOUT+c.getTime()}else{hbl.client.pollingmanager.expected_finish=c.getTime()+hbl.client.pollingmanager.LAG_CONSTANT}if(hbl.client.pollingmanager.first_poll_time==0){hbl.client.pollingmanager.first_poll_time=c.getTime()}var b=c.getTime()-hbl.client.pollingmanager.last_poll_end_time;var d=c.getTime()-hbl.client.pollingmanager.last_poll_start_time;var e=c.getTime()-hbl.client.last_sent_message;if(b>45000&&d<40000&&hbl.client.last_sent_message>0&&e>20000&&e<60000*5){}hbl.client.get_messages(a)},finished_last_poll:function(){var a=new Date();hbl.client.pollingmanager.last_poll_end_time=a.getTime()},saction:function(){var a=new Date();hbl.client.pollingmanager.last_sent_message_time=a.getTime()},raction:function(){var a=new Date();hbl.client.pollingmanager.last_action_time=a.getTime()},set_expected_finish:function(b){var a=new Date();hbl.client.pollingmanager.expected_finish=b+a.getTime()},check_failed_polling:function(){var a=new Date();if(hbl.client.pollingmanager.last_poll_start_time>hbl.client.pollingmanager.last_poll_end_time&&a.getTime()>hbl.client.pollingmanager.expected_finish&&(hbl.client.pollingmanager.current_poll_rate>hbl.client.pollingmanager.IGNORE_LAG_TIME||hbl.client.pollingmanager.current_poll_rate==0)){window.clearTimeout(hbl.client.pollingmanager.last_poll_timer);hbl.client.jsoncallback({},null);if(hbl.client.last_getmessages.getTime()-a<0){hbl.client.get_messages()}}hbl.client.pollingmanager.check_for_failed_timer=setTimeout("hbl.client.pollingmanager.check_failed_polling()",hbl.client.pollingmanager.check_failed_polling_rate)}},is_conversation:function(){var a;var c=false;var b=false;for(var a in hbl.client.buffer){if(hbl.client.buffer[a][0]=="you"){c=true}if(hbl.client.buffer[a][0]!="you"){b=true}}return(c&&b)},current_operator:function(){var b;var a="";for(var b in hbl.client.buffer){if(hbl.client.buffer[b][0]!="you"){a=hbl.client.buffer[b][0]}}return a},callbacks:{begin:function(a){hbl.client.jsoncallback(a,hbl.client.begin_call_back)},sendmessage:function(a){hbl.client.msg_callback(a)},sendpresence:function(a){},setvcard:function(a){},sendcommand:function(a){},end_popout:function(a){},popout:function(a){},getmessages:function(a){hbl.client.pollingmanager.finished_last_poll();hbl.client.jsoncallback(a,hbl.client.callbacks.pollmessages1)},pollmessages:function(a){hbl.client.pollingmanager.finished_last_poll();hbl.client.jsoncallback(a,hbl.client.callbacks.pollmessages1)},pollmessages1:function(a){if(a.disconnected){}else{try{if(hbl.client.first_time){hbl.client.first_time=false}if(a.exception=="no session found"){return}if(a.opavailable!=hbl.client.opavailable||hbl.client.opmessage!=a.opmessage||hbl.client.opstatus!=a.opstatus||hbl.client.opbusy!=a.opbusy||hbl.client.pop_out!=a.pop_out){hbl.client.eventmgr.handle("operator_status_change",{available:a.opavailable,opavailable:a.opavailable,status:a.opstatus,opstatus:a.opstatus,message:a.opmessage,busy:a.opbusy,pop_out:a.pop_out,pop_out_change:(hbl.client.pop_out!=a.pop_out),chatting:hbl.client.chatting,box_visible:hbl.client.box_visible});hbl.client.first_time=false;hbl.client.opavailable=a.opavailable;hbl.client.opmessage=a.opmessage;hbl.client.opstatus=a.opstatus;hbl.client.opbusy=a.opbusy;hbl.client.pop_out=a.pop_out}hbl.client.append1(a.buffer);hbl.client.passive_mode=a.passive_mode;hbl.client.pollingmanager.start_next_poll(a.opavailable,a.opbusy,hbl.client.config.vars.poll,(hbl.client.config.vars.start_passive&&hbl.client.passive_mode))}catch(b){throw b}}},setnickname:function(a){}},siteid:"",wc_sid:"",sid:"",proxy:null,offline_timeout:55*1000,offline_timeout_default:55*1000,offline_timeout_slow:150*1000,online_timeout:20*1000,chatting_timeout:700,current_timeout:20*1000,first_timeout:800,no_chat_timeout:40*1000,last_msg_time:new Date(),buffer:new Array(),check_get_message_timeout:20*1000,fast_polling:false,no_chat_timeout_slow:5*60*1000,online_poll_slow:120*1000,last_sent_message:0,myname:"you",jsoncallback:function(b,c){if(b.error){}if(c!=null){c(b)}hbl.client.jsonthrottle_locked=false;if(hbl.client.proxy.callq.length>0){var a=hbl.client.proxy.callq.shift();if(a[0]=="pollmessages"){hbl.client.proxy.docall(a[0],a[1],a[2],true,{timeout:10000,error_callback:function(){hbl.client.force_start_next_poll(hbl.client.config.vars.start_passive&&hbl.client.passive_mode)}})}else{if(a[0]=="getmessages"){hbl.client.proxy.docall(a[0],a[1],a[2],true,{timeout:40000,error_callback:function(){hbl.client.force_start_next_poll(false)}})}else{hbl.client.proxy.docall(a[0],a[1],a[2],true,{timeout:45000})}}}},begin_call_back:function(b){if(b!=null&&!b.error){hbl.client.sid=b.sid;hbl.client.wcsid=b.sid;hbl.client.hblid=b.hblid;hbl.client.chatting=(b.chatting=="on");hbl.client.opavailable=b.opavailable;hbl.client.opmessage=b.opmessage;hbl.client.opstatus=b.opstatus;hbl.client.opbusy=b.opbusy;hbl.client.pop_out=b.pop_out;hbl.client.ssl=b.ssl;hbl.client.box_visible=(b.box_visible=="on");hbl.client.geolocation=b.geocode_ip;hbl.client.ip_address=b.ipaddress;hbl.client.session_start=b.session_start;if(b.opavailable){for(var a=0;a<hbl.client.messageq.length;++a){if(typeof(hbl.client.messageq[a][0])=="string"){hbl.client.proxy.sendmessage(hbl.client.sid,hbl.client.messageq[a][0],hbl.client.messageq[a][1],hbl.client.msg_callback)}}}hbl.client.eventmgr.handle("chat_started",{chatting:(b.chatting=="on"),box_open:(b.box_open=="on"),nick:b.nick,box_visible:(b.box_visible=="on"),opstatus:b.opstatus,opavailable:b.opavailable,opmessage:b.opmessage,opbusy:b.opbusy,pop_out:b.pop_out,config:b.config,dconfig:b.dconfig,habla_message:b.habla_message,session_start:b.session_start,browser_ip:b.ipaddress,geolocation:b.geocode_ip});if(b.context){hbl.client.setContents(b.context);if(b.context.length>0){hmpmetrics.track("changed_page_while_chatting",{site_id:hbl.siteid,opavailable:b.opavailable,opbusy:b.opbusy,page:hbl.get_current_page()})}}if(hbl.client.config&&!hbl.client.config.vars.disable_set_cookies){hbl.util.set_cookie({name:"wcsid",value:hbl.client.sid,path:hbl.client.config.vars.cookie_path,expire:hbl.client.config.vars.session_expire})}hbl.util.set_cookie({name:"hblid",value:hbl.client.hblid,path:hbl.client.config.vars.hbl_cookie_path,expire:24*60*60*1000*356});hbl.client.eventmgr.handle("operator_status_change",{available:b.opavailable,opavailable:b.opavailable,opstatus:b.opstatus,status:b.opstatus,message:b.opmessage,busy:b.opbusy,pop_out:b.pop_out,pop_out_change:(hbl.client.pop_out!=b.pop_out),chatting:hbl.client.chatting,box_visible:hbl.client.box_visible});hbl.client.opavailable=b.opavailable;hbl.client.opmessage=b.opmessage;hbl.client.opstatus=b.opstatus;hbl.client.opbusy=b.opbusy;hbl.client.pop_out=b.pop_out;hbl.client.pollingmanager.start_next_poll(b.opavailable,b.opbusy,hbl.client.config.vars.poll,(hbl.client.config.vars.start_passive&&(b.chatting!="on")),true)}else{if(b&&b.error){hbl.client.eventmgr.handle("habla_error",{etype:b.error})}}},start:function(f,a,b,h,c){hbl.client.siteid=b;hbl.client.wcsid=f;if(hbl.client.hblid==undefined){hbl.client.hblid=a}hbl.client.eventmgr=h;hbl.client.config=c;hbl.client.event_driven=false;hbl.client.opstatus=null;hbl.client.opavailable=null;hbl.client.opmessage=null;hbl.client.chatting=false;hbl.client.pop_out=false;hbl.client.buffer=new Array();hbl.client.the_count=0;hbl.client.newlinecount=0;hbl.client.lastindex=0;hbl.client.last_getmessages=new Date();hbl.client.jsondata=null;hbl.client.jsonthrottle_locked=false;hbl.client.datareadycallback=null;hbl.client.getmsgcallback=null;hbl.client.first_time=true;hbl.client.incoming_pipeline.setTarget(this);try{if(hblrpcTrick){hbl.client.proxy=new hbl.client.jsonproxy("async"+hbl_hostname_delimiter+hbl_hostname,true);var d=parseInt(Math.random()*hbl_max_event).toString()+"-events"+hbl_hostname_delimiter;hbl.client.proxy2=new hbl.client.jsonproxy(d+hbl_hostname)}else{hbl.client.proxy=new hbl.client.jsonproxy(hbl_hostname);hbl.client.proxy2=hbl.client.proxy}if(hbl.config&&hbl.config.vars&&!hbl.config.vars.local_mode){hbl.client.proxy.begin(hbl.client.wcsid,hbl.client.hblid,hbl.client.siteid,hbl.get_current_page(),hbl.get_current_referrer(),c.vars.start_passive,c.vars.force_nickname,c.vars.no_system_messages,hbl.client.begin_call_back)}}catch(g){hbl.client.chatting=false;hbl.util.reportException(g);throw g}},get_messages:function(c){var a;try{if(c!=undefined||hbl.client.config.vars.poll||hbl.client.pollingmanager.current_poll_rate!=0){hbl.client.proxy.pollmessages(hbl.client.sid,hbl.client.lastindex,hbl.client.callbacks.pollmessages)}else{hbl.client.proxy2.getmessages(hbl.client.sid,hbl.client.lastindex,hbl.client.callbacks.getmessages)}}catch(b){hbl.util.reportException(b);hbl.client.chatting=false;throw b;throw"getmessage failed"}return false},force_start_next_poll:function(a){hbl.client.jsonthrottle_locked=false;hbl.client.pollingmanager.next_poll_time=0;hbl.client.pollingmanager.start_next_poll(hbl.client.opavailable,hbl.client.opbusy,hbl.client.config.vars.poll,a)},jsoncallback_norv:function(a){},jsonproxy:function(b,a){this.uri=b;this.callq=new Array();this.rnd=a},check_getmsg:function(){},setContents:function(a){if(!a||a.length==0){if(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.has_messages_in_history){a=[[null,"  ",0.2]]}else{return}}hbl.client.lastindex=0;for(var b=0;b<a.length;++b){hbl.client.buffer[hbl.client.buffer.length]=new Array(a[b][0],a[b][1]);if(a[b][2]>hbl.client.lastindex){hbl.client.lastindex=a[b][2]}}hbl.client.newlinecount=1;hbl.client.pollingmanager.raction();if(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.load_missed_messages){window.olark.__legacy_shim.load_missed_messages(a)}hbl.client.eventmgr.handle("receive_message",{type:"start",msg:a})},append:function(a){if(!a||!(a.length>0)){return}for(var b=0;b<a.length;++b){hbl.client.buffer[hbl.client.buffer.length]=new Array(a[b][0],a[b][1])}hbl.client.newlinecount+=a.length;hbl.client.pollingmanager.raction();hbl.client.pollingmanager.saction();hbl.client.pollingmanager.start_next_poll(hbl.client.opavailable,hbl.client.opbusy,hbl.client.config.vars.poll,false);hbl.client.chatting=true;hbl.client.eventmgr.handle("send_message",{type:"local_update",msg:a})},append1:function(a){if(!a||!(a.length>0)){return}var d=[];var c=0;for(var b=0;b<a.length;++b){if(a[b][2]>hbl.client.lastindex){var e=hbl.client.incoming_pipeline.run(a[b]);if(e!=undefined){hbl.client.buffer[hbl.client.buffer.length]=e;hbl.client.lastindex=e[2];d.push(e)}if(a[b]){c+=1}}else{}}hbl.client.newlinecount+=a.length;if(c>0){hbl.client.pollingmanager.raction();hbl.client.chatting=true}hbl.client.eventmgr.handle("receive_message",{type:"remote_update",msg:d});hmpmetrics.track("window_receive_message",{site_id:hbl.siteid,page:hbl.get_current_page()})},messageq:[],msg_callback:function(a){if(a.error=="no_site_id"){hbl.client.proxy.begin(hbl.client.wcsid,hbl.client.hblid,hbl.client.siteid,hbl.get_current_page(),hbl.get_current_referrer(),hbl.client.config.vars.start_passive,hbl.client.config.vars.force_nickname,hbl.config.vars.no_system_messages,hbl.client.begin_call_back,false)}else{if(a.error=="operator_is_busy"){hbl.eventmgr.handle("habla_error",{etype:"operator_is_busy"})}else{hbl.client.messageq.shift()}}},sendmessage:function(f,d){hbl.client.last_sent_message=new Date().getTime();var b;try{hbl.client.messageq.push(new Array(f,d));var a=new Array(new Array(hbl.client.myname,f,d));if(!d){hbl.client.append(a)}hbl.client.proxy.sendmessage(hbl.client.sid,a[0][1],!d,hbl.client.msg_callback)}catch(c){throw c}},setnickname:function(a){var b;try{hbl.client.proxy.setnickname(hbl.client.sid,a)}catch(c){throw c}},sendcommand:function(d,a){var b;try{hbl.client.proxy.sendcommand(hbl.client.sid,d,a)}catch(c){throw c}},setvcard:function(c,a,f){var b;try{hbl.client.proxy.setvcard(hbl.client.sid,c,a,f)}catch(d){throw d}},sendpresence:function(b,a){var c;try{hbl.client.proxy.sendpresence(hbl.client.sid,b,a)}catch(d){throw d}},log_event:function(b,a){if(!hbl.client.proxy){return}hbl.client.proxy.log_event(hbl.client.sid,b,a)},sendexpand:function(){if(!hbl.client.proxy){return}hbl.client.proxy.expandchat(hbl.client.sid)},sendcompress:function(){if(!hbl.client.proxy){return}hbl.client.proxy.compresschat(hbl.client.sid)},sendend:function(){if(!hbl.client.proxy){return}hbl.client.proxy.endchat(hbl.client.sid)},sendhide:function(){if(!hbl.client.proxy){return}hbl.client.proxy.hidechat(hbl.client.sid)},sendshow:function(){if(!hbl.client.proxy){return}hbl.client.proxy.showchat(hbl.client.sid)},popout:function(){if(!hbl.client.proxy){return}hbl.client.proxy.popout(hbl.client.sid)},end_popout:function(){if(!hbl.client.proxy){return}hbl.client.proxy.end_popout(hbl.client.sid)}};hbl.client.jsonproxy.prototype.docall=function(j,g,c,l,a){var k=a.tries;var h=a.timeout;var b=a.error_callback;if(hbl&&hbl.config&&hbl.config.vars.local_mode){return}if(l){if(hbl.client.jsonthrottle_locked){if(this.callq.length<2){this.callq[this.callq.length]=new Array(j,g,c)}return}}var d="";var f="";if(this.rnd){d=parseInt(Math.random()*10).toString()+"-"}hbl.util.last_js_id+=1;if(hbl.util.last_js_id>1900){if(j.match(/sendmessage/i)||j.match(/begin/i)){hbl.util.last_js_id=1}else{return}}if(j.match(/begin/i)&&!g[0]&&hbl_ext=="https"&&hblrpcTrick){d="start-"+parseInt(Math.random()*3).toString()+"."+hbl_hostname;d+="/"+j+"?"}else{d+=this.uri+"/"+j+"?"}if(g[0]){g[0]+="|o"+hbl.util.last_js_id}else{if(g.length>0){g[0]="|o"+hbl.util.last_js_id}}for(var e=0;e<g.length;++e){if(e>0){d+="&"}f="";if(g[e]){f=encodeURI(g[e]+"").replace(/\#/g,"%23").replace(/\&/g,"%26");if(e==0){f="HBLSID="+f}d+=f}}if(l){hbl.client.jsonthrottle_locked=true}hbl.util.append_script({scriptid:"o"+hbl.util.last_js_id,url:hbl_ext+"://"+d,tries:k,timeout:h,cache:true,error_callback:b});return null};hbl.client.jsonproxy.prototype.begin=function(a,j,i,g,c,k,f,e,d,h){if(h==undefined){h=true}var b=hblJavaScriptVersion+"-"+Math.random().toString();if(f){return this.docall(hblBegincall,new Array(a,j,i,g,b,c,k,f,e),d,h,{tries:3,timeout:20000})}else{return this.docall(hblBegincall,new Array(a,j,i,g,b,c,k,"",e),d,h,{tries:3,timeout:20000})}};hbl.client.jsonproxy.prototype.sendmessage=function(b,e,d,a){var c=hblJavaScriptVersion+"-"+Math.random().toString();return this.docall("sendmessage",new Array(b,e,d,c),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.sendcommand=function(c,d,b,a){return this.docall("sendcommand",new Array(c,d,b),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.setvcard=function(c,d,b,e,a){return this.docall("setvcard",new Array(c,d,b,e),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.setnickname=function(c,b,a){return this.docall("setnickname",new Array(c,b),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.sendpresence=function(b,c,d,a){return this.docall("sendpresence",new Array(b,c,d),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.getmessages=function(c,b,a){hbl.client.the_count++;hbl.client.last_getmessages=new Date();return this.docall("getmessages",new Array(c,b.toString(),hblJavaScriptVersion+"-"+(hbl.client.the_count+Math.random()).toString()),a,true,{timeout:40000,error_callback:function(){hbl.client.force_start_next_poll(false)}})};hbl.client.jsonproxy.prototype.pollmessages=function(c,b,a){hbl.client.the_count++;return this.docall("pollmessages",new Array(c,b.toString(),hblJavaScriptVersion+"-"+(hbl.client.the_count+Math.random()).toString()),a,true,{timeout:10000,error_callback:function(){hbl.client.force_start_next_poll(hbl.client.config.vars.start_passive&&hbl.client.passive_mode)}})};hbl.client.jsonproxy.prototype.popout=function(b,a){return this.docall("popout",new Array(b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.end_popout=function(b,a){return this.docall("end_popout",new Array(b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.log_event=function(c,d,b,a){return this.docall("log_event",new Array(c,d,b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.expandchat=function(b,a){return this.docall("expandchat",new Array(b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.compresschat=function(b,a){return this.docall("compresschat",new Array(b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.endchat=function(b,a){return this.docall("endchat",new Array(b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.showchat=function(b,a){return this.docall("showchat",new Array(b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl.client.jsonproxy.prototype.hidechat=function(b,a){return this.docall("hidechat",new Array(b,hblJavaScriptVersion+"-"+Math.random().toString()),a,false,{tries:3,timeout:45000})};hbl._hwindow=function(a,b,c){this.config=b;this.client=a;this.handlers=false;this.theme=undefined;this.eventmgr=c;this.loaded=false;this.expanded_textbox=false;this.has_typed=false;this.offline_msg_started=false;this.offline_msg_visible=false;this.pop_out=false;this.setTheme=function(d){if(this.theme){this.theme.remove()}this.theme=d;this.theme.build(this.config,this.client,this.config.vars.start_visible,this.config.vars.start_habla_window_visible);this.check_theme_for_link_div();hbl.util.pluginloader(this.config,this.client,this)};this.check_theme_for_link_div=function(){if(!this.theme){return}if(!this.theme.habla_link_div||(this.theme.habla_link_div.style&&this.theme.habla_link_div.style.display=="none")||(this.theme.habla_link_div.innerHTML.indexOf("http://hab.la")<0&&this.theme.habla_link_div.innerHTML.indexOf("http://www.olark.com")<0)||!this.theme.habla_link_div.parentNode){this.theme.habla_link_div=document.createElement("div");if(this.config.vars.force_name_habla_link_div){this.theme.habla_link_div.setAttribute("id","habla_link_div")}if(this.config.vars.special_link){this.theme.habla_link_div.innerHTML=this.config.vars.special_link.replace("hblink1","hblink9")}if(this.theme.config.vars.append_middle){this.theme.habla_middle_div.appendChild(this.theme.habla_link_div)}else{this.theme.habla_expanded_div.appendChild(this.theme.habla_link_div)}}if(!document.getElementById("hblink9")){this.theme.habla_link_div.innerHTML=hbl.util.decode_base64("RnJlZSA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/ZnJlZV9saXZlaGVscCIgaWQ9ImhibGluazkiIHRhcmdldD0iX2JsYW5rIj5PbGFyazwvYT4gbGl2ZWhlbHAgfCA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/bW9yZSIgaWQ9ImhibGluazk5IiB0YXJnZXQ9Il9ibGFuayI+R2V0IGl0ITwvYT48IS0taHR0cDovL3d3dy5vbGFyay5jb20tLT4=")}this.set_link(document.getElementById("hblink9"));this.set_link(document.getElementById("hblink99"));this.theme.habla_link_div.setAttribute("style",this.config.style_id.habla_link_div);this.theme.habla_link_div.style.textTransform="uppercase";this.theme.habla_link_div.style.padding="3px 0 5px 0";this.theme.habla_link_div.style.fontFamily="verdana, sans-serif";this.theme.habla_link_div.style.textAlign="center";this.theme.habla_link_div.style.fontSize="9px";this.theme.habla_link_div.style.letterSpacing="2px";this.theme.habla_link_div.style.color="#aaa";this.theme.habla_link_div.style.fontWeight="bold";if(document.getElementById("hblink9")){this.config.style.habla_link_a="font-family: verdana, sans-serif; text-transform: uppercase; font-size: 9px !important; letter-spacing: 2px; font-weight: bold; color: "+this.config.palette.link+"!important;";document.getElementById("hblink9").setAttribute("style",this.config.style.habla_link_a);document.getElementById("hblink9").style.color=this.config.palette.link;if(document.getElementById("hblink99")){document.getElementById("hblink99").setAttribute("style",this.config.style.habla_link_a);document.getElementById("hblink99").style.color=this.config.palette.link}}};this.set_link=function(d){if(d&&d.href){var e=d.href.split(/[\?\#]/);d.href=e[0]+"?rid="+hbl.siteid+"&"+e[1];d.onclick=function(){hmpmetrics.track("olark_link_clicked",{site_id:hbl.siteid,page:hbl.get_current_page(),extra:e[1]});return true}}};this.register_handlers=function(){if(this.handlers){return}this.handlers=true;this.eventmgr.register("window_focus",this.events.onWindowFocus,0);this.eventmgr.register("window_click",this.events.onWindowFocus,0);this.eventmgr.register("window_submit",this.events.onWindowSubmit,0);this.eventmgr.register("window_form_submit",this.events.onWindowFormSubmit,0);this.eventmgr.register("window_topbar_clicked",this.events.topBarClicked,0);this.eventmgr.register("habla_closebutton_a_onclick",this.events.closeClicked,0);this.eventmgr.register("habla_sizebutton_a_onclick",this.events.topBarClicked,0);this.eventmgr.register("habla_oplink_a_onclick",this.events.topBarClicked,0);this.eventmgr.register("operator_status_change",this.events.onOpstatusStatusChanged,0);this.eventmgr.register("receive_message",this.events.onChatUpdated,0);this.eventmgr.register("send_message",this.events.onChatUpdated,0);this.eventmgr.register("chat_started",this.events.onChatStarted,0);this.eventmgr.register("theme_loaded",this.events.onThemeLoaded,0)};this.get_operator_state=function(){if(this.config.vars.local_mode){return(this.config.vars.local_operator_state||"available")}if(this.opavailable){if(this.opbusy){return"available"}else{if(this.opstatus=="chat"||this.opstatus=="available"||!this.opstatus||this.opstatus==""){return"available"}else{return"notavailable"}}}else{return"notavailable"}};this.determine_window_status=function(d){var f={};if(window.olark&&window.olark.__legacy_shim){f=window.olark.__legacy_shim;if(f.box_state!=null){d.box_open=f.box_state=="expanded"?true:false}if(f.box_visible!=null){d.window.theme.visible=f.box_visible?true:false;d.box_visible=f.box_visible?true:false}var e=d.window.config.vars.close_hides_window;if(e&&f.box_state=="closed"){d.box_visible=false}d.window.theme.state=f.box_state||d.window.theme.state}if(d.pop_out&&!d.window.config.vars.is_popup){return false}if(d.pop_out_change&&!d.pop_out){return true}if(d.chatting||(hbl.client.buffer.length>0&&!d.window.config.vars.close_hides_window)){return true}if(d.box_open||d.window.theme.state=="expanded"){return true}if(d.window.config.vars.start_hidden&&!d.window.theme.visible){return false}if(d.window.config.vars.close_hides_window&&!d.box_visible){return false}if(d.window.config.vars.hide_not_available&&!d.opavailable){return false}if(d.window.config.vars.hide_not_available&&(d.opstatus!="chat"&&d.opstatus!=undefined&&d.opstatus!="")){return false}return true};this.setInputBox=function(f,e,d){this.theme.setInputBox(f,e,d)};this.setWindowText=function(){var f=this.get_operator_state();if((f=="notavailable"||this.offline_msg_started)&&this.config.vars.offline_msg_mode){this.setHeader(this.config.vars.not_available_text);this.setOfflineWindow(this.config.vars.offline_message);if(this.config.vars.show_pre_chat){this.theme.hidePreChat()}return}else{this.setOfflineWindow(false)}if(f=="notavailable"){this.setHeader(this.config.vars.not_available_text);this.setBody(this.config.vars.offline_message);return}if(f=="away"){if(this.config.vars.show_away_as_header&&this.opmessage){this.setHeader(this.opmessage,true)}else{this.setHeader(this.config.vars.busy_text||this.config.vars.away_text)}if(this.client.buffer.length==0){this.setBody(this.config.vars.away_message||this.config.vars.busy_message||this.config.vars.offline_message)}return}if(f=="busy"){this.setHeader(this.config.vars.busy_text);this.setBody(this.config.vars.busy_message);return}if(this.client.buffer.length==0){var e=(b.vars.force_nickname&&b.vars.force_nickname!="");var d=(window.olark&&window.olark.__legacy_shim)?true:false;if(this.config.vars.show_pre_chat&&!this.theme.pre_chat_sent&&(d||!e)){this.setShowPreChat(true)}else{this.setBody(this.config.vars.welcome_msg)}this.setHeader(this.config.vars.before_chat_text)}else{this.setHeader(this.config.vars.in_chat_text)}};this.appendFromBuffer=function(d){if(this.offline_msg_started){return}if(!this.theme){hbl.hwindow_last_buffer=d;this.eventmgr.register("theme_loaded",function(f){f.window.appendFromBuffer(hbl.hwindow_last_buffer);hbl.hwindow_last_buffer=""},100)}else{for(var e in d){this.theme.appendNiceMessage(d[e][0],d[e][1],true)}}};this.setHeader=function(d,e){if(d!=undefined){if(e){d=".."+d.substr(0,10)+".."}this.theme.setHeader(d)}};this.events={onOpstatusStatusChanged:function(d){d.window.opstatus=d.status;d.window.opmessage=d.message;d.window.opbusy=d.busy;d.window.pop_out=d.pop_out;if(!d.window.opavailable&&d.available&&!(d.window.config.vars.offline_msg_mode&&d.window.offline_msg_mode)){d.window.reloadBuffer()}d.window.opavailable=d.available;d.window.setWindowText();var e=d.window.determine_window_status(d);if(e||((d.available||!d.window.config.vars.hide_not_available)&&d.window.theme.visible)){d.window.show()}else{d.window.hide(1)}},onChatUpdated:function(d){d.window.setShowPreChat(false);d.window.appendFromBuffer(d.msg)},onChatStarted:function(d){d.window.opavailable=d.opavailable;d.window.opbusy=d.busy;if(d.config){d.window.config.merge(hbl.util.decode_base64(d.config,true))}if(d.dconfig){d.window.config.merge(hbl.util.decode_base64(d.dconfig,true))}if(d.nick!=null&&!d.nick.match(/webuser\d\d/)){d.window.setnickname(d.nick,1)}hbl.chat_started_arg=d;if(d.window.theme){d.window.theme.build(d.window.config,d.window.client,true);d.window.events.onThemeLoaded(d)}else{if(d.window.config.vars.theme_obj){d.window.setTheme(b.vars.theme_obj);d.window.events.onThemeLoaded(d)}else{hbl.chat_started_arg=d;var e="";if(d.window.config.vars.theme_path){e="http://"+hbl_static_hostname+"/"+d.window.config.vars.theme_path}if(d.window.config.vars.theme_url){e=d.window.config.vars.theme_url}hbl.util.simple_load_js_async(e)}}hbl.client.eventmgr.handle("chat_loaded",d)},onThemeLoaded:function(f){if(!f.window.theme){f.window.setTheme(f.obj)}if(hbl.util.BrowserDetect.backwards_position&&!hbl.config.monitor){hbl.config.render_ie_hacks()}var d=hbl.chat_started_arg;var e=d.window.determine_window_status(d);if(e){d.window.show(1);if((!d.pop_out||d.window.config.vars.is_popup)&&(d.box_open||d.window.config.vars.start_expanded||(window.olark&&window.olark.__legacy_shim&&olark.__legacy_shim.box_state=="expanded"))){d.window.expand()}}else{d.window.hide(1)}if(d.habla_message){d.window.config.vars.offline_message=d.habla_message["msg"];if(d.habla_message["header"]){d.window.config.vars.not_available_text=d.habla_message["header"];d.window.setHeader(habla_window.config.vars.not_available_text)}d.window.show(1);if(d.habla_message["expand"]){d.window.expand()}d.window.theme.habla_conversation_div.scrollTop=0}},onWindowFocus:function(d){d.window.normal();d.window.setWindowText()},topBarClicked:function(d){d.window.normal();if(d.window.expanded){d.window.compress();hmpmetrics.track("window_compressed",{site_id:hbl.siteid,page:hbl.get_current_page()});hbl.client.eventmgr.handle("window_compressed")}else{d.window.expand();hmpmetrics.track("window_expanded",{site_id:hbl.siteid,page:hbl.get_current_page()});hbl.client.eventmgr.handle("window_expanded")}return false},closeClicked:function(d){if(d.window.expanded){d.window.compress();hmpmetrics.track("window_compressed_close_clicked",{site_id:hbl.siteid});hbl.client.eventmgr.handle("window_compressed")}else{d.window.close();hmpmetrics.track("window_close",{site_id:hbl.siteid,page:hbl.get_current_page()});hbl.client.eventmgr.handle("window_closed")}return false},onWindowFormSubmit:function(d){d.window.send()},onWindowSubmit:function(d){var f=d.event;var g;if(window.event){f=window.event;g=f.keyCode}else{if(f.which){g=f.which}}if(g==13){d.window.send()}if(!d.window.config.vars.disable_expand_text_input&&!d.window.expanded_textbox&&d.window.theme.getMessageInputFieldValue().length>d.window.config.vars.resize_length){d.window.expanded_textbox=true;d.window.setInputHeight(d.window.config.vars.resize_input_height)}if(!d.window.config.vars.disable_expand_text_input&&d.window.expanded_textbox&&d.window.theme.getMessageInputFieldValue().length<d.window.config.vars.resize_length){d.window.expanded_textbox=false;d.window.setInputHeight(d.window.config.vars.input_height)}}};this.send_pipeline=new hbl.util.pipeline(this);this.send_pipeline.add(hbl.pipelines.nickname,999);return this};hbl._hwindow.prototype.setnickname=function(a,b){if(b==undefined){this.client.setnickname(nickname)}if(!b){hmpmetrics.track("window_setnickname",{site_id:hbl.siteid,page:hbl.get_current_page()})}};hbl._hwindow.prototype.show=function(a){if(this.theme.state=="closed"){this.theme.state="compressed"}this.theme.show();this.visible=true;if(!a&&!this.config.vars.disable_rpc_state){this.client.sendshow()}hbl.eventmgr.handle("habla_window_changed",{type:"show"})};hbl._hwindow.prototype.popout=function(a){if(!a){this.client.popout()}this.pop_out=true;hbl.client.pop_out=true;habla_popup=window.open(hblPopupURL+"?siteid="+hbl.siteid+"&wcsid="+hbl.client.sid,"habla_popout","width=310,height=600,scrollbars=no,location=no,status=no,menubar=no,toolbar=no,directories=no,resizable=yes");habla_popup.focus();this.hide(a);if(!a){hmpmetrics.track("window_popout",{site_id:hbl.siteid,page:hbl.get_current_page()})}};hbl._hwindow.prototype.end_popout=function(a){this.pop_out=false;if(!a){this.client.end_popout()}hbl.eventmgr.handle("habla_window_changed",{type:"endpop_out"});if(!a){hmpmetrics.track("window_end_popout",{site_id:hbl.siteid,page:hbl.get_current_page()})}};hbl._hwindow.prototype.close=function(a){this.theme.close();if(!a&&!this.config.vars.disable_rpc_state){this.client.sendend()}if(this.config.vars.close_hides_window){this.hide()}hbl.eventmgr.handle("habla_window_changed",{type:"close"});if(!a){hmpmetrics.track("window_close",{site_id:hbl.siteid,page:hbl.get_current_page()})}};hbl._hwindow.prototype.hide=function(a){this.theme.hide();this.visible=false;if(!a&&!this.config.vars.disable_rpc_state){this.client.sendhide()}hbl.eventmgr.handle("habla_window_changed",{type:"hide"})};hbl._hwindow.prototype.setWidth=function(a){if(this.theme){this.theme.setWidth(a)}hbl.eventmgr.handle("habla_window_changed",{type:"resize"})};hbl._hwindow.prototype.setInputHeight=function(a){this.theme.setInputHeight(a);hbl.eventmgr.handle("habla_window_changed",{type:"resize"})};hbl._hwindow.prototype.setHeight=function(a){if(this.theme){this.theme.setHeight(a)}hbl.eventmgr.handle("habla_window_changed",{type:"resize"})};hbl._hwindow.prototype.compress=function(){this.expanded=false;this.theme.compress();if(hbl.util.BrowserDetect.backwards_position&&this.visible){if(window.hbl.__ie6_floating_div_monitor){window.hbl.__ie6_floating_div_monitor.__move_to_correct_location()}}hbl.eventmgr.handle("habla_window_changed",{type:"compress"});if(!this.config.vars.disable_rpc_state){this.client.sendcompress()}};hbl._hwindow.prototype.expand=function(){this.expanded=true;if(hbl.util.BrowserDetect.backwards_position){if(this.config.vars.ycorner=="bottom"){this.theme.setXY(this.theme.habla_window_div.style.left.match(/\d\d*/),this.theme.habla_window_div.style.top.match(/\d\d*/)-this.config.vars.convo_height-this.config.vars.panel_offset)}}if(this.theme){this.theme.expand()}if(!this.config.vars.disable_rpc_state){this.client.sendexpand()}hbl.eventmgr.handle("habla_window_changed",{type:"expand"})};hbl._hwindow.prototype.setPosition=function(a){this.theme.setPosition(a);if(!hbl.wcsid){hmpmetrics.track("window_set_position",{site_id:hbl.siteid,corner:a,page:hbl.get_current_page()})}};hbl._hwindow.prototype.setInline=function(a){this.theme.setInline(a);if(!hbl.wcsid){hmpmetrics.track("window_set_inline",{site_id:hbl.siteid,value:a,page:hbl.get_current_page()})}};hbl._hwindow.prototype.setMargins=function(d,c,b,a){this.theme.setMargins(d,c,b,a);if(!hbl.wcsid){hmpmetrics.track("window_set_margins",{site_id:hbl.siteid,left:d,top:c,right:b,bottom:a,page:hbl.get_current_page()})}};hbl._hwindow.prototype.getHeader=function(){return this.theme.getHeader()};hbl._hwindow.prototype.reloadBuffer=function(){this.theme.setBody("");this.appendFromBuffer(this.client.buffer)};hbl._hwindow.prototype.setBody=function(a){this.setOfflineWindow(false);this.theme.setBody(a||"")};hbl._hwindow.prototype.setOfflineWindow=function(a){this.theme.setOfflineWindow(a);if(!hbl.wcsid){hmpmetrics.track("window_show_offline_message_box",{site_id:hbl.siteid,page:hbl.get_current_page()})}};hbl._hwindow.prototype.setShowPreChat=function(a){this.theme.setShowPreChat(a);if(!hbl.wcsid&&a){hmpmetrics.track("window_show_enter_name",{site_id:hbl.siteid,page:hbl.get_current_page()})}};hbl._hwindow.prototype.highlight=function(){this.theme.highlight()};hbl._hwindow.prototype.normal=function(){this.theme.normal()};hbl._hwindow.prototype.send=function(){var c;var b=this.theme.getMessageInputField();var a=this.theme.getMessageInputFieldValue();if(a==this.config.vars.say_text){this.theme.setMessageInputFieldValue("")}else{if(a&&a.length>0){try{var f=a;this.theme.setMessageInputFieldValue("");f=this.send_pipeline.run(f);if(f){this.client.sendmessage(f);hmpmetrics.track("window_sent_message",{site_id:hbl.siteid,opavailable:this.opavailable,opbusy:this.opbusy,page:hbl.get_current_page()})}this.normal()}catch(d){throw d}}}if(!this.config.vars.disableFocus){b.focus();setTimeout(function(){habla_window.theme.getMessageInputField().focus()},10)}return false};hbl.hwindow_util.wrap_and_create_links=function(d,e){var c=e;function a(j){var l=j.childNodes;if(l.length==0){if(!j.data){return j}else{var m=j.data.replace(/([^\s]{13})/g,"$1%|%").split("%|%");if(m.length>1){var o=document.createElement("span");for(var k in m){if(typeof(m[k])=="string"){var n=document.createElement("span");if(k>0){n.setAttribute("class","olark_new_line")}m[k]=m[k].replace("<","&lt;");m[k]=m[k].replace(">","&gt;");n.innerHTML=m[k];o.appendChild(n);o.appendChild(document.createElement("wbr"))}}return o}else{return j}}}else{for(var k in l){if(typeof(l[k])=="object"){j.replaceChild(a(l[k]),l[k])}}return j}}function h(i){var j=document.createElement("div");j.innerHTML=i;j=a(j);return j.innerHTML}function g(i){i=i.replace(/<\/*body[^>]*>/ig,"");i=i.replace(/<((\/[^a]|[^\/a])[^>]*)>/ig,"<wbr>&lt;$1&gt;<wbr>");if(c.config.vars.parse_links){i=f(i,c.config.vars.url_handler_target_window,b)}return h(i)}function f(i,l,j){var k=/\b(\[*)(?:((?:https?|ftp|file|telnet|ldap|irc|nntp|news|irc):\/\/[^\s'"<>]*|[-\w]+@(?:[-\w]+\.)+[\w]{2,6})\b|([\w\-])+(\.([\w\-])+)*@((([a-zA-Z0-9])+(([\-])+([a-zA-Z0-9])+)*\.)+([a-zA-Z])+(([\-])+([a-zA-Z0-9])+)*)|about:[A-Z0-9._?=%-]{4,19}|[A-Z0-9\_-]*[\.]{0,1}[A-Z0-9\_-]*[\.]{0,1}[A-Z0-9\_-]+\.[A-Z]{2,4}[^\s'"<>]*)\]*\)*\b/gi;i=i.replace(k,function(n,m){return'<a href="'+j(n)+'" target="'+l+'" >'+n+"</a>"});return i}function b(i){return hbl.hwindow_util.get_habla_url(i,c)}return g(d)};hbl.hwindow_util.get_habla_url=function(d,a){var h=/^\s*(ftp|file|telnet|ldap|irc|nntp|news|irc).*/;var f=/^\s*(\/).*/;var g=/^\s*(https?)\:\/\/.+/;var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var i=function(j){j=j.replace("http://","");j=j.replace("https://","");if(j.indexOf(document.domain)==0){return true}else{return false}};var c=function(j){if(a.config.vars.url_handler){return a.config.vars.url_handler+"?siteid="+hbl.siteid+"&wcsid="+a.client.sid+"&url="+hbl.util.encode_base64(j)}else{return j}};if(b.test(d)){return"mailto:"+d}else{if(h.test(d)){return d}else{if(f.test(d)){return document.location.protocol+"//"+document.domain+d}else{var e=null;if(g.test(d)){e=d}else{if(i(d)){e=document.location.protocol+"//"+d}else{e="http://"+d}}if(i(e)){return e}else{return c(e)}}}}};hbl.pipelines.nickname=function(c,b){if(c.substr(0,6)=="/nick "){var a=c.substr(6);b.client.setnickname(a);hmpmetrics.track("window_slash_nick_called",{site_id:hbl.siteid,page:hbl.get_current_page()});return undefined}return c};hbl.pipelines.wrap_text=function(b,a){return hbl.hwindow_util.wrap_and_create_links(b,a)};hbl.pipelines.emoticons=function(b,a){b=b.replace(/\;\-\)/,"<code><big>;-)</big></code>");b=b.replace(/\:\-\)/,"<code><big>:-)</big></code>");return b};hbl.pipelines.push_url=function(d,c){msg_t=d;d=d[1];if(d.substr(0,6)=="!push "){var b="";d=d.replace(/&lt;/i,"[");d=d.replace(/\/*&gt;/i,"]");if(d.match(/<a/)){var a=d.match(/src\s*=\s*"*([^\"]+)\"*/i);if(a.length>1){b=a[1]}}else{if(d.match(/\[(http[^\]]+)\s*\]/i)){a=d.match(/\[(http[^\]]+)\]/i);b=a[1]}else{b=d.substr(6,d.length-6)}}if(b!=""){hmpmetrics.track("window_push_url",{site_id:hbl.siteid,page:hbl.get_current_page()});document.location=hbl.hwindow_util.get_habla_url(b,habla_window);return undefined}}return msg_t};hbl.client.incoming_pipeline.add(hbl.pipelines.push_url,999);hbl.plugins.incoming_notification_vars={};hbl.plugins.incoming_notification=function(){this.name="incoming_notification";this.load=function(a){hbl.plugins.incoming_notification_vars.freq=4000;hbl.plugins.incoming_notification_vars.flashicon=false;hbl.plugins.incoming_notification_vars.flashing=false;if(a.hwindow.config.vars.flash_titlebar){a.hwindow.eventmgr.register("receive_message",this.onReceiveMessage);a.hwindow.eventmgr.register("window_focus",this.onWindowFocus);a.hwindow.eventmgr.register("window_click",this.onWindowFocus)}if(a.hwindow.config.vars.flash_icons){hbl.plugins.incoming_notification_vars.default_flash_icon=a.hwindow.config.vars.default_flash_on_icon;hbl.plugins.incoming_notification_vars.flashicon=true;hbl.plugins.incoming_notification_vars.default_icon=hbl.plugins.incoming_notification_vars.remove_current_icon(1);if(!hbl.plugins.incoming_notification_vars.default_icon){hbl.plugins.incoming_notification_vars.default_icon=a.hwindow.config.vars.default_flash_off_icon}}};this.onReceiveMessage=function(a){if(a.type=="remote_update"){a.window.highlight();hbl.plugins.incoming_notification_vars.flashme=true;hbl.plugins.incoming_notification_vars.last_msg="";if(hbl.client.buffer&&hbl.client.buffer[hbl.client.buffer.length-1]){hbl.plugins.incoming_notification_vars.last_msg=hbl.client.buffer[hbl.client.buffer.length-1][1].substr(0,10);a.window.setHeader(".."+hbl.plugins.incoming_notification_vars.last_msg+"..")}if(hbl.plugins.incoming_notification_vars.last_msg!=""&&!hbl.plugins.incoming_notification_vars.flashing){hbl.plugins.incoming_notification_vars.flash()}}};this.onWindowFocus=function(a){if(hbl.oldtitle){document.title=hbl.oldtitle}hbl.plugins.incoming_notification_vars.flashme=false;a.window.normal()};hbl.plugins.incoming_notification_vars.flash=function(){hbl.plugins.incoming_notification_vars.flashing=true;if(document.title.indexOf("Message Received")<0&&hbl.plugins.incoming_notification_vars.flashme){hbl.oldtitle=document.title;if(!hbl.oldtitle){hbl.oldtitle=""}document.title="(Message Received: "+hbl.plugins.incoming_notification_vars.last_msg+") "+hbl.oldtitle;if(hbl.plugins.incoming_notification_vars.flashicon){hbl.plugins.incoming_notification_vars.set_icon(hbl.plugins.incoming_notification_vars.default_flash_icon)}}else{document.title=hbl.oldtitle;if(hbl.plugins.incoming_notification_vars.flashicon){hbl.plugins.incoming_notification_vars.set_icon(hbl.plugins.incoming_notification_vars.default_icon)}}if(hbl.plugins.incoming_notification_vars.flashme){setTimeout(hbl.plugins.incoming_notification_vars.flash,hbl.plugins.incoming_notification_vars.freq)}else{hbl.plugins.incoming_notification_vars.flashing=false}};hbl.plugins.incoming_notification_vars.remove_current_icon=function(e){if(!document.getElementsByTagName("head")||document.getElementsByTagName("head").length==0){return}var b=document.getElementsByTagName("head")[0].getElementsByTagName("link");for(var c=0;c<b.length;c++){var d=b[c];if(d.type=="image/x-icon"&&d.rel=="shortcut icon"){var a=d.href;if(!e){document.getElementsByTagName("head")[0].removeChild(d)}return a}}return undefined};hbl.plugins.incoming_notification_vars.set_icon=function(b){var a=document.createElement("link");a.type="image/x-icon";a.rel="shortcut icon";a.href=b;hbl.plugins.incoming_notification_vars.remove_current_icon();if(!document.getElementsByTagName("head")||document.getElementsByTagName("head").length==0){return}document.getElementsByTagName("head")[0].appendChild(a)}};hbl.plugins.messages_received=0;hbl.plugins.expand_on_receive_message=function(){this.name="expand_on_receive_message";this.load=function(a){a.hwindow.eventmgr.register("receive_message",this.onReceiveMessage,-1)};this.onReceiveMessage=function(a){hbl.plugins.messages_received+=1;if(a.window.pop_out){return}if(a.type!="start"&&((!a.window.config.vars.expandOnFirstMessageReceived||a.window.config.vars.expandOnMessageReceived)||hbl.plugins.messages_received==1)){hbl.client.eventmgr.handle("window_expanded");a.window.expand();a.window.show()}else{if(a.type!="start"&&a.window.theme&&a.window.theme.state=="closed"){a.window.theme.state="compressed";a.window.show()}}}};hbl.plugins.away_div_handler=function(){this.name="away_div_handler";this.load=function(a){hbl.util.hide_div("habla_unavailable_div");hbl.util.hide_div("habla_available_div");if(!hbl.util.show_div("habla_loading_div",a.hwindow.config.vars.habla_special_div_show_type)){hbl.util.show_div("habla_unavailable_div",a.hwindow.config.vars.habla_special_div_show_type)}if(document.getElementById("habla_available_div")!=undefined||document.getElementById("habla_unavailable_div")!=undefined){a.hwindow.eventmgr.register("operator_status_change",this.onOperatorStatusChange)}};this.onOperatorStatusChange=function(a){var d=a.available;var b=a.status;var c=a.message;if(d&&(!b||b=="chat"||!a.window.config.vars.hide_when_away)){hbl.util.show_div("habla_available_div",a.window.config.vars.habla_special_div_show_type);hbl.util.hide_div("habla_unavailable_div");hbl.util.hide_div("habla_loading_div")}else{hbl.util.hide_div("habla_available_div");hbl.util.show_div("habla_unavailable_div",a.window.config.vars.habla_special_div_show_type);hbl.util.hide_div("habla_loading_div")}}};hbl.plugins.auto_initiate=function(){this.load=function(a){if(a.hwindow.config.vars.auto_initiate_allowed&&a.hwindow.config.vars.auto_initiate){a.hwindow.eventmgr.register("chat_loaded",this.onChatLoad)}};this.onChatLoad=function(a){if(a.session_start&&!a.opbusy&&a.opavailable){habla_window.auto_initiated=false;setTimeout(function(){if(hbl.client.buffer.length==0&&hbl.client.opavailable){habla_window.show();habla_window.expand();habla_window.auto_initiated=true;var b=a.window.config.vars.auto_initiate_message;habla_window.theme.appendNiceMessage(a.window.config.vars.auto_initiate_name,b[Math.floor(Math.random()*b.length)],true,false,true);habla_window.highlight();hbl.client.buffer=[" "];habla_window.send_pipeline.add(function(c){if(habla_window.auto_initiated){hbl.client.sendmessage(habla_window.config.vars.auto_initiate_response_notify,true);habla_window.auto_initiated=false}return c},10000);if(habla_window.config.vars.auto_initiate_notify){hbl.client.sendmessage(habla_window.config.vars.auto_initiate_notify_msg,true)}}},parseInt(a.window.config.vars.auto_initiate_period*1000))}}};hbl.plugins.google_translate=function(){this.name="googletranslate";this.load=function(a){}};hbl.plugins.sounds=function(){this.name="sounds";this.load=function(a){if(a.conf.vars.enableSounds==1){hbl.util.simple_load_js_async(a.conf.vars.plugin_path+"contributed/sounds.js")}}};hbl.plugins.smileys=function(){this.name="smileys";this.load=function(a){if(a.conf.vars.enableSmileys==1){hbl.util.simple_load_js_async(a.conf.vars.plugin_path+"contributed/smileys.js")}}};hbl.plugins.googleanalytics=function(){this.name="googleanalytics";var d=1;var g=2;var e=3;var f=2;var c=3;var a=4;var b=5;var h=6;var i=this;i.__has_arrived=undefined;i.__wrap=function(j){return j.replace(/[^\w\d]/g,"_").replace(/\_[\_]*/,"_")};i.load=function(j){i.config=j.conf;if(i.config.vars.enable_google_analytics&&(window.pageTracker||i.config.vars.google_analytics_id)){var k=(("https:"==document.location.protocol)?"https://ssl.":"http://www.");if(!window._gat){window._gaq=window._gaq||[];window._gaq.push(["t1._setAccount",i.config.vars.google_analytics_id]);window._gaq.push(["t1._setDomainName",i.config.vars.google_analytics_domain]);window._gaq.push(["t1._setAllowLinker",true]);window._gaq.push(["t1._initData"]);hbl.util.simple_load_js_async(k+"google-analytics.com/ga.js")}j.hwindow.eventmgr.register("receive_message",i.onReceiveMessage);j.hwindow.eventmgr.register("send_message",i.onSendMessage);j.hwindow.eventmgr.register("operator_status_change",i.onOperatorStatusChange);j.hwindow.eventmgr.register("window_expanded",i.onExpandChat);j.hwindow.eventmgr.register("window_compressed",i.onCompressChat);j.hwindow.eventmgr.register("window_closed",i.onCloseChat)}};i.__with_page_tracker=function(l){if(i.__page_tracker){l(i.__page_tracker)}else{if(window._gat){if(i.config.vars.google_analytics_id){i.__page_tracker=_gat._getTracker(i.config.vars.google_analytics_id);i.__page_tracker._setDomainName(i.config.vars.google_analytics_domain);i.__page_tracker._setAllowLinker(true);i.__page_tracker._initData();l(i.__page_tracker)}else{if(window.pageTracker){try{window.pageTracker._initData();i.__page_tracker=window.pageTracker;l(i.__page_tracker)}catch(k){}}}}else{var j=function(){var m=this;m._trackEvent=function(){window._gaq.push(m.__append(["t1._trackEvent"],arguments))};m._setCustomVar=function(){window._gaq.push(m.__append(["t1._setCustomVar"],arguments))};m._setVar=function(){window._gaq.push(m.__append(["t1._setVar"],arguments))};m.__append=function(p,o){for(var n=0;n<o.length;n++){p.push(o[n])}return p}};i.__page_tracker=new j();l(i.__page_tracker)}}};i.__with_custom_vars=function(j){if(i.config.vars.google_analytics_use_custom_vars){i.__with_page_tracker(j)}};i.onSendMessage=function(j){i.__with_custom_vars(function(k){if(!i.__registered_chat_on_this_page){i.__registered_chat_on_this_page=true;k._setCustomVar(c,i.__wrap(hblName+": Visitor Sent Message"),"Yes",e)}});i.__with_page_tracker(function(k){k._trackEvent(hblName,"Visitor Sent a Message",(hbl.client.is_conversation()?"Conversation":"Not a Conversation"))})};i.onReceiveMessage=function(j){i.__with_custom_vars(function(k){k._setCustomVar(b,i.__wrap(hblName+": Had Conversation"),i.__wrap("most recently with "+hbl.client.current_operator()),d);k._setVar(hblName+": Received Message from Operator ("+hbl.client.current_operator()+")");if(hbl.client.is_conversation()){k._setCustomVar(a,i.__wrap(hblName+": Had Conversation"),i.__wrap("with "+hbl.client.current_operator()),g)}if(hbl.client.buffer.length>h&&hbl.client.is_conversation()){k._setCustomVar(a,i.__wrap(hblName+": Had Conversation with "+h+"+ messages"),i.__wrap("with "+hbl.client.current_operator()),g);k._setVar(hblName+": Had Conversation with "+h+"+ messages with "+hbl.client.current_operator())}i.__with_page_tracker(function(l){l._trackEvent(hblName,"Operator Sent a Message",hbl.client.current_operator())})})};i.onExpandChat=function(j){i.__with_page_tracker(function(k){k._trackEvent(hblName,"Visitor Expanded Chat Box",(hbl.client.opavailable?"Operator was Available":"Operator was Unavailable"))})};i.onCompressChat=function(j){i.__with_page_tracker(function(k){k._trackEvent(hblName,"Visitor Compressed Chat Box",(hbl.client.opavailable?"Operator was Available":"Operator was Unavailable"))})};i.onCloseChat=function(j){i.__with_page_tracker(function(k){k._trackEvent(hblName,"Visitor Closed Chat Box",(hbl.client.opavailable?"Operator was Available":"Operator was Unavailable"))})};i.onOperatorStatusChange=function(j){if(hbl.client.session_start){return}i.__with_custom_vars(function(k){if(hbl.client.opavailable){k._setCustomVar(f,i.__wrap(hblName+": Operator Presence"),"Available",g)}else{k._setCustomVar(f,i.__wrap(hblName+": Operator Presence"),"Unavailable",g)}});if(i.__has_arrived){return}i.__has_arrived=true;i.__with_page_tracker(function(k){if(hbl.client.opavailable){k._trackEvent(hblName,"Visitor Arrived","Operator was Available")}else{if(j.window.opbusy){k._trackEvent(hblName,"Visitor Arrived","Operator was Busy")}else{k._trackEvent(hblName,"Visitor Arrived","Operator was Unavailable")}}})}};hbl.themes.default_theme=function(){this.appended=true;this.last_msg=-1;this.visible=false;this.highlighted=false;this.state="compressed";this.message_sent=false;this.offline_window=false;this.pre_chat_sent=false;this.ready=false;this.build=function(config,client,start_visible,start_habla_window_div_visible){this.client=client;this.config=config;this.set_config();this.load_styles();this.div=undefined;this.divid=config.vars.divid;this.build_dom(start_visible);this.set_dom_event_handlers();this.config.init_from_config(this);this.palette_hack();this.render_styles();if(!this.config.vars.disableJSStyles&&!this.config.vars.no_palette){this.render_palette()}this.set_default_text();this.register_handlers();this.ready=true;if(this.config.vars.disableJSStyles&&!this.config.vars.start_hidden){this.show()}hbl.eventmgr.handle("post_theme_loaded")};this.palette_hack=function(){if(hbl.need_ugly_backwards_palette_hack){var new_palette={};for(var y in this.config.style_classes_map){for(var j in this.config.style_classes_map[y]){for(var i in this.config.palette){if("hbl_pal_"+i==this.config.style_classes_map[y][j]){this.config.style_classes_map[y][j]="hbl_pal_"+i+"_local";new_palette[i+"_local"]=this.config.palette[i]}}}}this.config.palette=new_palette}};this.set_config=function(){var t=new hbl.hconfig();t.style_classes={};t.style_classes_map={habla_window_div:["habla_window_div_position","habla_window_div_base","hbl_pal_font_family","hbl_var_font_size"],habla_closebutton_a:["habla_button","habla_button_a_normal","hbl_var_font_size_header","hbl_pal_button_bg","hbl_pal_button_fg"],habla_sizebutton_a:["habla_button","habla_button_a_normal","hbl_var_font_size_header","hbl_pal_button_bg","hbl_pal_button_fg"],habla_popout_a:["habla_button","habla_button_a_normal","hbl_var_font_size_header","hbl_pal_button_bg","hbl_pal_button_fg"],habla_end_popout_a:["habla_button","habla_button_a_normal","hbl_var_font_size_header","hbl_pal_button_bg","hbl_pal_button_fg"],habla_button_normal:["habla_button","habla_button_a_normal","hbl_var_font_size_header","hbl_pal_button_bg","hbl_pal_button_fg"],habla_button_highlighted:["habla_button","habla_button_a_highlighted","hbl_var_font_size_header","hbl_pal_button_bg_highlight","hbl_pal_button_fg_highlight"],habla_button_hover:["habla_button","habla_button_a_hover","hbl_var_font_size_header","hbl_pal_button_bg_hover","hbl_pal_button_fg_hover"],habla_panel_div:["habla_panel_border","hbl_pal_main_bg","hbl_pal_panel_border"],habla_oplink_a:["habla_oplink_a_normal","hbl_var_font_size_header","hbl_pal_title_fg"],habla_oplink_hover:["habla_oplink_a_hover","hbl_var_font_size_header","hbl_pal_title_fg"],habla_wcsend_input_pre:["habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_input_pre_fg","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_wcsend_input_post:["habla_wcsend_field","habla_wcsend_input_post","habla_wcsend_input_normal","hbl_pal_main_fg","hbl_pal_font_family","hbl_var_font_size"],habla_wcsend_input:["habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_control_border","hbl_pal_font_family","hbl_var_font_size"],habla_wcsend_input_highlighted:["habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_highlighted","hbl_pal_control_highlight_border","hbl_pal_font_family","hbl_var_font_size"],habla_name_input:["habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_wcsend_input:["habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_offline_email_input:["habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_offline_body_input:["habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_offline_clear_div:["clear_style"],habla_chatform_form:["habla_chatform_form"],habla_input_div:["habla_input_div"],habla_pre_chat_email_input:["habla_pre_chat_form_field","habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_pre_chat_name_input:["habla_pre_chat_form_field","habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_pre_chat_phone_input:["habla_pre_chat_form_field","habla_wcsend_field","habla_wcsend_input_pre","habla_wcsend_input_normal","hbl_pal_font_family","hbl_var_font_size","hbl_pal_control_border"],habla_offline_message_sent_div:["habla_offline_message_sent_div"],habla_pre_chat_div:["habla_pre_chat_div"],habla_offline_message_div:["habla_offline_message_div","hbl_pal_control_border","hbl_pal_main_fg"],habla_conversation_div:["habla_conversation_div","hbl_pal_control_border","hbl_pal_main_fg","hbl_pal_main_bg"],habla_offline_message_sent_div:["habla_offline_message_sent_div","hbl_pal_control_border","hbl_pal_main_fg"],habla_say_text_span:["habla_say_text_span","hbl_pal_main_fg"],habla_submit_button:["habla_submit_button"],habla_offline_submit_input:["habla_offline_submit_input","hbl_pal_offline_submit_fg","hbl_pal_control_border","hbl_pal_offline_submit_bg"],habla_pre_chat_submit_input:["habla_pre_chat_form_field","habla_offline_submit_input","hbl_pal_offline_submit_fg","hbl_pal_control_border","hbl_pal_offline_submit_bg"],habla_offline_error_span:["habla_offline_error_span"],habla_pre_chat_clear_div:["clear_style"],habla_conversation_p_item:["habla_conversation_p_item","hbl_pal_main_fg"],habla_conversation_person1:["habla_conversation_person1","hbl_pal_local_fg"],habla_conversation_person2:["habla_conversation_person2","hbl_pal_remote_fg"],habla_conversation_text_span:["habla_conversation_text_span","hbl_pal_main_fg"],habla_topbar_div_compressed:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_compressed"],habla_topbar_div:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"],habla_topbar_div_highlighted:["habla_topbar_div_highlighted","hbl_pal_title_fg_highlight","hbl_pal_title_bg_highlight","habla_topbar_div_expanded"]};t.style_id={habla_link_div:"padding: 3px 0 5px 0 !important; font-family: verdana, sans-serif; text-align: center; text-transform: uppercase; font-size: 9px; letter-spacing: 2px; font-weight: bold; color: #aaa !important;"};t.vars={habla_sizebutton_text_expanded:"_",habla_sizebutton_text_compressed:"^",habla_closebutton_text:"x",habla_popout_text:">",habla_end_popout_text:"&lt;&lt;"};if(hbl.util.BrowserDetect.backwards_position){t.style_classes_map.habla_window_div=["habla_window_div_position_floating_ie","habla_window_div_base"]}if(this.config.vars.is_inline){t.style_classes_map.habla_window_div=["habla_window_div_position_inline","habla_window_div_base"]}this.config.merge(t);var t2=new hbl.hconfig();t2.load_defaults();this.config.merge(t2);this.config.remap_palette();this.config.remap_palette();if(this.config.vars.enable_buttons){this.config.style_classes_map.habla_topbar_div=["habla_topbar_div_normal","habla_topbar_clickable","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"]}};this.build_dom=function(start_visible,start_habla_window_div_visible){if(document.getElementById(this.divid)){this.appended=false}this.habla_window_div=hbl.util.find_or_create_div(this.divid,(this.config.vars.not_append==undefined?hbl.util.get_body():undefined));if(!start_habla_window_div_visible){hbl.util.hide_div(this.habla_window_div)}this.habla_panel_div=hbl.util.find_or_create_div("habla_panel_div",this.habla_window_div);this.habla_both_div=hbl.util.find_or_create_div("habla_both_div",this.habla_panel_div);hbl.util.hide_div(this.habla_panel_div);this.habla_topbar_div=hbl.util.find_or_create_div("habla_topbar_div",this.habla_both_div);this.habla_expanded_div=hbl.util.find_or_create_div("habla_expanded_div",this.habla_panel_div);this.habla_compressed_div=hbl.util.find_or_create_div("habla_compressed_div",this.habla_panel_div);this.habla_closed_div=hbl.util.find_or_create_div("habla_closed_div",this.habla_window_div);if(!start_visible){this.hide()}this.habla_oplink_a=hbl.util.find_or_create_el("habla_oplink_a","a");if(this.config.vars.show_end_popout){this.habla_end_popout_a=hbl.util.find_or_create_el("habla_end_popout_a","a");this.habla_topbar_div.appendChild(this.habla_end_popout_a)}else{if(this.config.vars.show_popout){this.habla_popout_a=hbl.util.find_or_create_el("habla_popout_a","a");this.habla_topbar_div.appendChild(this.habla_popout_a)}}if(this.config.vars.enable_buttons){if(!this.config.vars.hide_min_max_buttons){this.habla_closebutton_a=hbl.util.find_or_create_el("habla_closebutton_a","a");this.habla_topbar_div.appendChild(this.habla_closebutton_a);this.habla_sizebutton_a=hbl.util.find_or_create_el("habla_sizebutton_a","a");this.habla_topbar_div.appendChild(this.habla_sizebutton_a)}}this.habla_topbar_div.appendChild(this.habla_oplink_a);this.habla_middle_div=hbl.util.find_or_create_div("habla_middle_div",this.habla_expanded_div);this.habla_conversation_div=hbl.util.find_or_create_div("habla_conversation_div",this.habla_middle_div);this.habla_offline_message_sent_div=hbl.util.find_or_create_div("habla_offline_message_sent_div",this.habla_middle_div);this.habla_offline_message_sent_div.style.display="none";this.habla_offline_message_span=hbl.util.find_or_create_el("habla_offline_message_span","span");this.habla_offline_message_div=hbl.util.find_or_create_div("habla_offline_message_div",this.habla_middle_div);this.habla_offline_message_div.style.display="none";this.habla_name_input=hbl.util.find_or_create_el("habla_name_input","textarea");this.habla_offline_email_input=hbl.util.find_or_create_el("habla_offline_email_input","textarea");this.habla_offline_body_input=hbl.util.find_or_create_el("habla_offline_body_input","textarea");this.habla_offline_clear_div=hbl.util.find_or_create_el("habla_offline_clear_div","div");this.habla_offline_submit_input=hbl.util.find_or_create_el("habla_offline_submit_input","input");this.habla_offline_submit_input.setAttribute("type","submit");this.habla_offline_error_span=hbl.util.find_or_create_el("habla_offline_error_span","span");this.habla_offline_message_div.appendChild(this.habla_offline_message_span);this.habla_offline_message_div.appendChild(this.habla_name_input);this.habla_offline_message_div.appendChild(this.habla_offline_email_input);this.habla_offline_message_div.appendChild(this.habla_offline_body_input);this.habla_offline_message_div.appendChild(hbl.util.find_or_create_el("habla_br","br"));this.habla_offline_message_div.appendChild(this.habla_offline_error_span);this.habla_offline_message_div.appendChild(this.habla_offline_submit_input);this.habla_offline_message_div.appendChild(this.habla_offline_clear_div);this.habla_pre_chat_span=hbl.util.find_or_create_el("habla_pre_chat_span","span");this.habla_pre_chat_div=hbl.util.find_or_create_div("habla_pre_chat_div",this.habla_middle_div);this.habla_pre_chat_div.style.display="none";this.habla_pre_chat_name_input=hbl.util.find_or_create_el("habla_pre_chat_name_input","textarea");this.habla_pre_chat_clear_div=hbl.util.find_or_create_el("habla_pre_chat_clear_div","div");this.habla_pre_chat_email_input=hbl.util.find_or_create_el("habla_pre_chat_email_input","textarea");this.habla_pre_chat_phone_input=hbl.util.find_or_create_el("habla_pre_chat_phone_input","textarea");this.habla_pre_chat_submit_input=hbl.util.find_or_create_el("habla_pre_chat_submit_input","input");this.habla_pre_chat_submit_input.setAttribute("type","submit");this.habla_pre_chat_error_span=hbl.util.find_or_create_el("habla_pre_chat_error_span","span");this.habla_pre_chat_div.appendChild(this.habla_pre_chat_span);this.habla_pre_chat_div.appendChild(this.habla_pre_chat_name_input);this.habla_pre_chat_div.appendChild(this.habla_pre_chat_email_input);this.habla_pre_chat_div.appendChild(this.habla_pre_chat_phone_input);this.habla_pre_chat_div.appendChild(hbl.util.find_or_create_el("habla_br_2","br"));this.habla_pre_chat_div.appendChild(this.habla_pre_chat_error_span);this.habla_pre_chat_div.appendChild(this.habla_pre_chat_submit_input);this.habla_pre_chat_div.appendChild(this.habla_pre_chat_clear_div);this.habla_chatform_form=hbl.util.find_or_create_el("habla_chatform_form","form");this.habla_chatform_form.setAttribute("action","#");this.habla_chatform_form.setAttribute("method","GET");this.habla_chatform_form.setAttribute("autocomplete","off");this.habla_input_div=hbl.util.find_or_create_el("habla_input_div","div");this.habla_wcsend_input=hbl.util.find_or_create_el("habla_wcsend_input","textarea");this.habla_wcsend_input.setAttribute("size",this.config.vars.input_box_size);this.habla_input_div.appendChild(this.habla_wcsend_input);if(hbl.util.BrowserDetect.need_submit_button){this.habla_submit_button=hbl.util.find_or_create_el("habla_submit_button","input");this.habla_submit_button.setAttribute("type","button");this.habla_input_div.appendChild(this.habla_submit_button)}this.habla_chatform_form.appendChild(this.habla_input_div);this.habla_middle_div.appendChild(this.habla_chatform_form)};this.set_events=function(el,_name,nokey){if(el==undefined){return}eval('el.onblur      =  function(a) { if(!a) a = window.event; habla_window.eventmgr.handle("'+_name+'_onblur", {target : a.target ? a.target : a.srcElement, event: a  });};');eval('el.onfocus     =  function(a) { if(!a) a = window.event; habla_window.eventmgr.handle("'+_name+'_onfocus", {target : a.target ? a.target : a.srcElement, event: a });};');eval('el.onclick     =  function(a) { if(!a) a = window.event; habla_window.eventmgr.handle("'+_name+'_onclick", {target : a.target ? a.target : a.srcElement, event: a }); a.cancelBubble = true;if (a.stopPropagation) a.stopPropagation(); return false; };');eval('el.onmouseover =  function(a) { if(!a) a = window.event; habla_window.eventmgr.handle("'+_name+'_onmouseover", {target : a.target ? a.target : a.srcElement, event: a });};');eval('el.onmouseout  =  function(a) { if(!a) a = window.event; habla_window.eventmgr.handle("'+_name+'_onmouseout", {target : a.target ? a.target : a.srcElement, event: a });};')};this.set_dom_event_handlers=function(){if(this.habla_submit_button){this.habla_submit_button.onclick=function(){habla_window.eventmgr.handle("window_form_submit",{event:undefined})}}this.set_events(this.habla_wcsend_input,"habla_wcsend_input",true);this.set_events(this.habla_name_input,"habla_name_input");this.set_events(this.habla_offline_email_input,"habla_offline_email_input");this.set_events(this.habla_offline_body_input,"habla_offline_body_input");this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input");this.set_events(this.habla_pre_chat_email_input,"habla_pre_chat_email_input");this.set_events(this.habla_pre_chat_name_input,"habla_pre_chat_phone_input");this.set_events(this.habla_pre_chat_name_input,"habla_pre_chat_name_input");this.set_events(this.habla_pre_chat_submit_input,"habla_pre_chat_submit_input");this.habla_conversation_div.onclick=function(){return habla_window.eventmgr.handle("habla_conversation_div_onclick")};this.habla_chatform_form.onfocus=function(){habla_window.eventmgr.handle("habla_chatform_form_onfocus")};this.habla_chatform_form.onsubmit=function(e){habla_window.eventmgr.handle("window_form_submit",{event:e});return false};this.habla_pre_chat_phone_input.onkeypress=function(e){if(!e){e=window.event}keynum=undefined;if(window.event){e=window.event;keynum=e.keyCode}else{if(e.which){keynum=e.which}}if(keynum==13){habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick");return false}};this.habla_pre_chat_email_input.onkeypress=function(e){if(!e){e=window.event}keynum=undefined;if(window.event){e=window.event;keynum=e.keyCode}else{if(e.which){keynum=e.which}}if(keynum==13){habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick");return false}};this.habla_pre_chat_name_input.onkeypress=function(e){if(!e){e=window.event}keynum=undefined;if(window.event){e=window.event;keynum=e.keyCode}else{if(e.which){keynum=e.which}}if(keynum==13){habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick");return false}};this.habla_wcsend_input.onkeypress=function(e){if(!e){e=window.event}keynum=undefined;if(window.event){e=window.event;keynum=e.keyCode}else{if(e.which){keynum=e.which}}if(!habla_window.theme.habla_wcsend_input.has_typed){if(keynum!=13){habla_window.setInputBox(habla_window.theme.habla_wcsend_input,String.fromCharCode(keynum),"highlight")}else{habla_window.setInputBox(habla_window.theme.habla_wcsend_input,"","highlight")}habla_window.theme.habla_wcsend_input.has_typed=true;return false}if(keynum==13){habla_window.eventmgr.handle("window_submit",{event:e});return false}return true};this.habla_wcsend_input.onkeyup=function(e){habla_window.eventmgr.handle("window_submit",{event:e})};this.set_events(this.habla_oplink_a,"habla_oplink_a");if(this.config.vars.show_end_popout){this.set_events(this.habla_end_popout_a,"habla_end_popout_a")}else{if(this.config.vars.show_popout){this.set_events(this.habla_popout_a,"habla_popout_a")}}if(this.config.vars.enable_buttons){this.habla_topbar_div.onclick=function(e){habla_window.eventmgr.handle("window_topbar_clicked");if(!e){e=window.event}e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}return false};if(!this.config.vars.hide_min_max_buttons){this.set_events(this.habla_closebutton_a,"habla_closebutton_a");this.set_events(this.habla_sizebutton_a,"habla_sizebutton_a")}}else{this.habla_oplink_a.onclick=function(){return false}}};this.styles=[];this.set_css_style=function(url){url=url.replace("static.olark.com",hbl_static_hostname);if(!this.config.vars.inline_css_url){return}if(!this.style_div){this.style_div=hbl.util.find_or_create_el("habla_style_div","link");this.style_div.setAttribute("type","text/css");this.style_div.setAttribute("rel","stylesheet");hbl.util.get_head().appendChild(this.style_div);this.style_div.setAttribute("href",url)}else{var style_div=hbl.util.find_or_create_el("habla_style_div_alternative","link");style_div.setAttribute("type","text/css");style_div.setAttribute("rel","alternative stylesheet");hbl.util.get_head().appendChild(style_div);style_div.setAttribute("href",url);var a=document.getElementById("habla_style_div");var b=document.getElementById("habla_style_div_alternative");a.setAttribute("rel","alternative stylesheet");b.setAttribute("rel","stylesheet");a.id="habla_style_div_alternative";b.id="habla_style_div"}};this.load_styles=function(){if((!this.config.vars.disableJSStyles)||this.config.vars.force_olark_css){if(hbl.util.BrowserDetect.backwards_position&&this.config.vars.inline_css_url_ie){this.config.vars.inline_css_url=this.config.vars.inline_css_url_ie}if(!this.config.vars.inline_css_url){this.config.vars.inline_css_url=hbl_ext+"://"+hbl_static_hostname+"/themes/base/theme.css"}if(!this.config.vars.inline_css_url.match("http")){this.config.vars.inline_css_url=hbl_ext+"://"+this.config.vars.inline_css_url}this.set_css_style(this.config.vars.inline_css_url)}};this.render_styles=function(){var nickname_is_overridden_in_api=window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.nickname_is_overridden;if(!this.config.vars.require_name||nickname_is_overridden_in_api){this.habla_pre_chat_name_input.style.display="none"}if(!this.config.vars.require_phone){this.habla_pre_chat_phone_input.style.display="none"}if(!this.config.vars.require_email){this.habla_pre_chat_email_input.style.display="none"}this.config.render_all_styles(this)};this.setInputBox=function(el,val,style,extra){el.value=val;this.setInputBoxStyle(el,style,extra)};this.setInputBoxStyle=function(el,style,extra){if(extra){this.config.set_element_classes(el,"habla_wcsend_input_post")}else{this.config.set_element_classes(el,"habla_wcsend_input_pre")}if(style=="normal"){this.config.set_element_classes(el,"habla_wcsend_input")}else{if(style=="highlight"){this.config.set_element_classes(el,"habla_wcsend_input_highlighted")}}};this.set_default_text=function(){this.set_default_text_event(this.habla_name_input,"habla_name_input",this.config.vars.habla_name_input_text);this.set_default_text_event(this.habla_offline_email_input,"habla_offline_email_input",this.config.vars.habla_offline_email_text);this.set_default_text_event(this.habla_offline_body_input,"habla_offline_body_input",this.config.vars.habla_offline_body_text);this.set_default_text_event(this.habla_pre_chat_name_input,"habla_pre_chat_name_input",this.config.vars.habla_name_input_text);this.set_default_text_event(this.habla_pre_chat_email_input,"habla_pre_chat_email_input",this.config.vars.habla_offline_email_text);this.set_default_text_event(this.habla_pre_chat_phone_input,"habla_pre_chat_phone_input",this.config.vars.habla_offline_phone_text);this.set_default_text_event(this.habla_wcsend_input,"habla_wcsend_input",this.config.vars.textbox_message||this.config.vars.say_text);this.habla_offline_submit_input.value=this.config.vars.habla_offline_submit_value;this.set_events(this.habla_wcsend_input,"habla_wcsend_input");this.set_events(this.habla_offline_email_input,"habla_offline_email_input");this.set_events(this.habla_offline_body_input,"habla_offline_body_input");this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input");this.habla_offline_message_sent_div.innerHTML=this.config.vars.habla_offline_sent_text;if(this.habla_closebutton_a){this.habla_closebutton_a.innerHTML=this.config.vars.habla_closebutton_text}if(this.habla_sizebutton_a){this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed}if(this.habla_popout_a){this.habla_popout_a.innerHTML=this.config.vars.habla_popout_text}if(this.habla_end_popout_a){this.habla_end_popout_a.innerHTML=this.config.vars.habla_end_popout_text}if(this.habla_submit_button){this.habla_submit_button.value=this.config.vars.send_text}if(this.habla_pre_chat_submit_input){this.habla_pre_chat_submit_input.value=this.config.vars.pre_chat_submit}this.habla_pre_chat_span.innerHTML=this.config.vars.pre_chat_message;this.setHeader(this.config.vars.check_for_status);this.setBody(this.config.vars.welcome_msg)};this.set_default_text_event=function(obj,obj_string,default_text){this.setInputBox(obj,default_text);obj.default_text=default_text;obj.has_typed=false;hbl.eventmgr.register(obj_string+"_onblur",function(arg){arg.window.theme.setInputBoxStyle(arg.target,"normal");if(arg.target.value==""){arg.target.value=arg.target.default_text;arg.target.has_typed=false}},0);hbl.eventmgr.register(obj_string+"_onclick",function(arg){if(!arg.target.has_typed){arg.target.has_typed=true;arg.window.setInputBox(arg.target,"","highlight")}arg.window.theme.setInputBoxStyle(arg.target,"highlight")},0);hbl.eventmgr.register(obj_string+"_onfocus",function(arg){if(!arg.target.has_typed){arg.target.has_typed=true;arg.window.setInputBox(arg.target,"","highlight")}arg.window.theme.setInputBoxStyle(arg.target,"highlight")},0)};this.set_rollover_event=function(obj,obj_string,off_class,on_class){if(!obj){return}obj.on_class=on_class;obj.off_class=off_class;hbl.eventmgr.register(obj_string+"_onmouseover",function(arg){arg.window.config.set_element_classes(arg.target,arg.target.on_class)},0);hbl.eventmgr.register(obj_string+"_onmouseout",function(arg){arg.window.config.set_element_classes(arg.target,arg.target.off_class)},0);hbl.eventmgr.register(obj_string+"_onclick",function(arg){arg.window.config.set_element_classes(arg.target,arg.target.off_class)},0)};this.register_handlers=function(){this.set_rollover_event(this.habla_popout_a,"habla_popout_a","habla_button_normal","habla_button_hover");this.set_rollover_event(this.habla_end_popout_a,"habla_end_popout_a","habla_button_normal","habla_button_hover");this.set_rollover_event(this.habla_sizebutton_a,"habla_sizebutton_a","habla_button_normal","habla_button_hover");this.set_rollover_event(this.habla_closebutton_a,"habla_closebutton_a","habla_button_normal","habla_button_hover");this.set_rollover_event(this.habla_oplink_a,"habla_oplink_a","habla_oplink_a","habla_oplink_hover");hbl.eventmgr.register("habla_conversation_div_onclick",function(arg){habla_window.eventmgr.handle("window_click")},0);hbl.eventmgr.register("habla_chatform_form_onfocus",function(arg){habla_window.eventmgr.handle("window_focus")},0);hbl.eventmgr.register("habla_popout_a_onclick",function(arg){arg.window.popout()},0);hbl.eventmgr.register("habla_end_popout_a_onclick",function(arg){arg.window.end_popout();setTimeout(function(){window.close()},2)},0);hbl.eventmgr.register("habla_wcsend_input_onclick",function(arg){arg.window.eventmgr.handle("window_focus")},0);hbl.eventmgr.register("habla_pre_chat_submit_input_onclick",function(arg){var conf=arg.window.config;var pre_chat_email=arg.window.theme.habla_pre_chat_email_input;var pre_chat_name=arg.window.theme.habla_pre_chat_name_input;var pre_chat_phone=arg.window.theme.habla_pre_chat_phone_input;if((conf.vars.require_name<1||pre_chat_name.has_typed)&&(conf.vars.require_phone<1||pre_chat_phone.has_typed)&&(conf.vars.require_email<1||(pre_chat_email.has_typed&&pre_chat_email.value.match(/\@/)))){arg.window.theme.habla_pre_chat_error_span.innerHTML="";arg.window.client.setnickname(pre_chat_name.value||pre_chat_email.value);var msg="";if(pre_chat_name.value&&pre_chat_name.value!=undefined){msg+="name: "+pre_chat_name.value}if(pre_chat_email.value&&pre_chat_email.value!=undefined){msg+="\nemail: "+pre_chat_email.value}if(pre_chat_phone.value&&pre_chat_phone.value!=undefined){msg+="\nphone: "+pre_chat_phone.value}if(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.send_prechat_info){window.olark.__legacy_shim.send_prechat_info({name:pre_chat_name.value,email:pre_chat_email.value,phone:pre_chat_phone.value})}else{arg.window.client.sendmessage(msg,true)}arg.window.theme.pre_chat_sent=true;arg.window.setShowPreChat(false)}else{arg.window.theme.habla_pre_chat_error_span.innerHTML=arg.window.config.vars.pre_chat_error_text}},0);hbl.eventmgr.register("habla_offline_submit_input_onclick",function(arg){if(arg.window.theme.message_sent){arg.window.theme.setOfflineWindow(arg.window.theme.config.vars.habla_offline_sent_text)}else{if(arg.window.theme.habla_offline_body_input.has_typed&&arg.window.theme.habla_offline_email_input.has_typed){arg.window.theme.message_sent=true;tocall=hblPostURL+"?site_id="+hbl.siteid+"&"+hbl.util.urlencode({body:arg.window.theme.habla_offline_body_input.value,email:arg.window.theme.habla_offline_email_input.value,name:arg.window.theme.habla_name_input.value,location:document.location,referrer:document.referrer});arg.window.theme.habla_offline_error_span.innerHTML=arg.window.config.vars.sending_text;hbl.util.load_js_async(tocall);arg.window.theme.setOfflineWindow(arg.window.theme.config.vars.habla_offline_sent_text);hmpmetrics.track("sent_offline_message",{site_id:hbl.siteid,page:hbl.get_current_page()})}else{arg.window.theme.habla_offline_error_span.innerHTML=arg.window.config.vars.email_body_error_text}}},0);hbl.eventmgr.register("habla_wcsend_input_onmouseover",function(arg){arg.window.eventmgr.handle("window_focus")},0)};this.remove=function(){if(this.appended){hbl.util.remove_element(this.divid)}};this.setShowPreChat=function(txt){if(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status){return}else{if(txt){this.habla_pre_chat_div.style.display="block";this.habla_conversation_div.style.display="none";this.habla_wcsend_input.style.display="none"}else{this.habla_pre_chat_div.style.display="none";this.habla_conversation_div.style.display="block";this.habla_wcsend_input.style.display="block"}}};this.hidePreChat=function(){this.habla_pre_chat_div.style.display="none"};this.setOfflineWindow=function(txt){if(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status){return}else{if(!txt){this.offline_window=false;this.habla_offline_message_div.style.display="none";this.habla_offline_message_sent_div.style.display="none";this.habla_conversation_div.style.display="block";this.habla_wcsend_input.style.display="block"}else{this.habla_offline_message_span.innerHTML=txt;if(this.message_sent){this.habla_offline_message_sent_div.style.display="block";this.habla_offline_message_div.style.display="none";this.offline_window=false}else{this.offline_window=true;this.habla_offline_message_div.style.display="block"}this.habla_conversation_div.style.display="none";this.habla_wcsend_input.style.display="none"}}};this.scroll_conversation_history_to_most_recent=function(){var self=this;setTimeout(function(){self.habla_conversation_div.scrollTop=self.habla_conversation_div.scrollHeight},10)};this.setBody=function(txt,do_not_clear_body){this.habla_conversation_div.innerHTML="";this.config.render_class(this.habla_conversation_div,"habla_conversation_message_off","habla_conversation_message_on");if(txt!=""){var txt=hbl.util.as_dom(txt);this.config.render_class(this.habla_conversation_div,"habla_conversation_message_on","habla_conversation_message_off");this.habla_conversation_div.appendChild(txt)}this.scroll_conversation_history_to_most_recent()};this.getBody=function(){return this.habla_conversation_div.innerHTML};this.appendNiceMessage=function(sender,txt,clear_body,skip_pipeline){if(txt==undefined||sender==undefined){return}if(!skip_pipeline){txt=this.display_pipeline.run(txt)}if(txt){if(window.olark&&window.olark.__legacy_shim){if(window.habla_window){txt=hbl.hwindow_util.wrap_and_create_links(txt,window.habla_window)}}var message=document.createElement("p");this.config.set_element_classes(message,"habla_conversation_p_item");var span=document.createElement("span");if(sender==this.config.vars.myname){span.innerHTML=this.config.vars.local_user_display_name;this.config.set_element_classes(span,"habla_conversation_person1")}else{span.innerHTML=(this.config.vars.local_name_override?this.config.vars.local_name_override:sender)+" : ";this.config.set_element_classes(span,"habla_conversation_person2")}var span2=document.createElement("span");this.config.set_element_classes(span2,"habla_conversation_text_span");span2.innerHTML=txt;message.appendChild(span);message.appendChild(span2);this.appendMessage(message,clear_body)}window.habla_window.theme.scroll_conversation_history_to_most_recent()};this.appendMessage=function(txt,clear_body){if(this.last_msg==-1&&clear_body){this.setBody("")}var txt=hbl.util.as_dom(txt);this.last_msg+=1;txt.setAttribute("id","habla_msg_"+this.last_msg);this.habla_conversation_div.appendChild(txt);this.scroll_conversation_history_to_most_recent()};this.setHeader=function(txt){this.habla_oplink_a.innerHTML=txt};this.getHeader=function(){return this.habla_oplink_a.innerHTML};this.hide=function(){this.visible=false;if(this.habla_conversation_div){this.habla_conversation_div.style.overflow="hidden"}hbl.util.hide_div(this.habla_window_div);hbl.util.hide_div(this.habla_panel_div);hbl.util.hide_div(this.habla_both_div);hbl.util.hide_div(this.habla_closed_div);hbl.util.hide_div(this.habla_expanded_div);hbl.util.hide_div(this.habla_compressed_div)};this.focus_on_the_input_box=function(){var self=this;if(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.disable_input_focusing){return}if(!self.config.vars.is_inline&&!self.config.vars.disableFocus&&self.habla_wcsend_input&&self.habla_chatform_form.style.display!="none"){setTimeout(function(){if(self.habla_chatform_form.style.display!="none"){try{self.habla_wcsend_input.focus()}catch(e){}}},20)}};this.expand=function(){var last_state=this.state;var self=this;this.state="expanded";if(this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_expanded){this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded}this.show();this.focus_on_the_input_box()};this.compress=function(){this.state="compressed";if(this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_compressed){this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed}this.show()};this.show=function(){var self=this;if(!this.ready){return}this.visible=true;if(this.config.vars.disableJSStyles){hbl.util.show_div(this.habla_window_div)}if(this.state=="closed"){hbl.util.hide_div(this.habla_expanded_div);hbl.util.hide_div(this.habla_panel_div);hbl.util.hide_div(this.habla_compressed_div);this.habla_conversation_div.style.overflow="hidden";hbl.util.show_div(this.habla_closed_div)}else{if(this.state=="expanded"){hbl.util.hide_div(this.habla_compressed_div);hbl.util.hide_div(this.habla_closed_div);hbl.util.show_div(this.habla_panel_div);hbl.util.show_div(this.habla_expanded_div);hbl.util.show_div(this.habla_both_div);this.habla_conversation_div.style.overflow="auto";this.scroll_conversation_history_to_most_recent();if(this.habla_sizebutton_a){this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded}this.focus_on_the_input_box();this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div")}else{if(this.state=="compressed"){hbl.util.hide_div(this.habla_expanded_div);hbl.util.hide_div(this.habla_closed_div);hbl.util.show_div(this.habla_panel_div);hbl.util.show_div(this.habla_both_div);hbl.util.show_div(this.habla_compressed_div);this.habla_conversation_div.style.overflow="hidden";this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_compressed");if(this.habla_sizebutton_div){this.habla_sizebutton_div.innerHTML=this.config.vars.habla_sizebutton_text_compressed}}}}};this.close=function(){this.state="closed";this.show()};this.setWidth=function(width){var set_width=width;this.habla_panel_div.style.width=width+"px";if(hbl.util.BrowserDetect.backwards_dimension||(hbl.util.BrowserDetect.browser=="Explorer"&&hbl.util.BrowserDetect.backwards_dimension)){set_width=(width-this.config.vars.input_width_offset_compat)+"px"}else{if(hbl.util.BrowserDetect.browser=="Explorer"){set_width=(width-this.config.vars.input_width_offset_ie)+"px"}else{set_width=(width-this.config.vars.input_width_offset_normal)+"px"}}this.habla_wcsend_input.style.width=set_width;this.habla_name_input.style.width=set_width;this.habla_offline_body_input.style.width=set_width;this.habla_offline_email_input.style.width=set_width;this.habla_pre_chat_name_input.style.width=set_width;this.habla_pre_chat_email_input.style.width=set_width;this.habla_pre_chat_phone_input.style.width=set_width};this.setInputHeight=function(height){var height=(height>18?height:18);if(hbl.util.BrowserDetect.backwards_dimension){height=(height>24?height:24)}this.habla_wcsend_input.style.height=height+"px"};this.setFormInputHeight=function(height){var height=(height>18?height:18);if(hbl.util.BrowserDetect.backwards_dimension){height=(height>24?height:24)}height=height+"px";this.habla_name_input.style.height=height;this.habla_offline_email_input.style.height=height;this.habla_pre_chat_name_input.style.height=height;this.habla_pre_chat_email_input.style.height=height;this.habla_pre_chat_phone_input.style.height=height};this.render_palette=function(){var pal=this.config.palette;if(this.config.vars.limited_palette){pal=this.config.vars.limited_palette}for(var i in pal){if(typeof(this.config.palette[i])=="string"){var res=hbl.util.getElementsByClass(this.habla_window_div,"hbl_pal_"+i);for(var j in res){if(res[j].style){if(i.match("_fg")){res[j].style.color=this.config.palette[i]}else{if(i.match("_bg")){res[j].style.backgroundColor=this.config.palette[i]}else{if(i.match("_border")){res[j].style.borderColor=this.config.palette[i]}}}}}}}};this.getX=function(){return this.habla_window_div.style.left.match(/\d\d*/)};this.getY=function(){return this.habla_window_div.style.top.match(/\d\d*/)};this.setXY=function(x,y){this.habla_window_div.style.top=y;this.habla_window_div.style.left=x};this.setHeight=function(height){var offline_height=(parseInt(height)-85)>0?(parseInt(height)-85):0;this.habla_offline_body_input.style.height=offline_height+"px";this.habla_conversation_div.style.height=height+"px"};this.setMargins=function(left,top,right,bottom){this.habla_window_div.style.marginTop=top+"px";this.habla_window_div.style.marginLeft=left+"px";this.habla_window_div.style.marginRight=right+"px";this.habla_window_div.style.marginBottom=bottom+"px"};this.setInline=function(val){if(val){var __display=this.habla_window_div.style.display;this.habla_window_div.setAttribute("style","");this.config.style_classes_map.habla_window_div=["habla_window_div_position_inline","habla_window_div_base"];this.habla_window_div.style.display=__display}else{if(hbl.util.BrowserDetect.backwards_position){this.config.style_classes_map.habla_window_div=["habla_window_div_position_floating_ie","habla_window_div_base"]}else{this.config.style_classes_map.habla_window_div=["habla_window_div_position_floating","habla_window_div_base"]}}this.config.render_element_classes(this,"habla_window_div")};this.setPosition=function(val){var extra="";var __display=this.habla_window_div.style.display;this.config.style_classes_map.habla_window_div=["habla_window_div_base"];if(val=="BR"||val=="BottomRight"){this.habla_window_div.setAttribute("style","");this.habla_window_div.style.bottom=this.config.vars.bottom_margin+"px";this.habla_window_div.style.right=this.config.vars.right_margin+"px"}else{if(val=="BL"||val=="BottomLeft"){this.habla_window_div.setAttribute("style","");this.habla_window_div.style.bottom=this.config.vars.bottom_margin+"px";this.habla_window_div.style.left=this.config.vars.left_margin+"px"}else{if(val=="TR"||val=="TopRight"){this.habla_window_div.setAttribute("style","");this.habla_window_div.style.top=this.config.vars.top_margin+"px";this.habla_window_div.style.right=this.config.vars.right_margin+"px"}else{if(val=="TL"||val=="TopLeft"){this.habla_window_div.setAttribute("style","");this.habla_window_div.style.top=this.config.vars.top_margin+"px";this.habla_window_div.style.left=this.config.vars.left_margin+"px"}}}}this.habla_window_div.style.display=__display;if(hbl.util.BrowserDetect.backwards_position){this.habla_window_div.style.position="absolute"}else{this.habla_window_div.style.position="fixed"}this.config.render_element_classes(this,"habla_window_div")};this.highlight=function(){if(this.highlighted){return}this.config.set_element_classes(this.habla_closebutton_a,"habla_button_highlighted");this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_highlighted");this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_highlighted");this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input_highlighted");this.highlighted=true};this.normal=function(){if(!this.highlighted){return}this.config.set_element_classes(this.habla_closebutton_a,"habla_button_normal");this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_normal");this.config.set_element_classes(this.habla_topbar_div,"habla_button_normal");this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div");this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input");this.highlighted=false};this.getMessageInputField=function(){return this.habla_wcsend_input};this.getMessageInputFieldValue=function(){return this.habla_wcsend_input.value};this.setMessageInputFieldValue=function(val){this.habla_wcsend_input.value=val};this.display_pipeline=new hbl.util.pipeline(this);this.display_pipeline.add(hbl.pipelines.wrap_text,999);this.display_pipeline.add(hbl.pipelines.emoticons,1000);if(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.pipeline_disabler){this.display_pipeline.add(window.olark.__legacy_shim.pipeline_disabler,1001)}};hbl.eventmgr.register("habla_preload_done",function(a){if(!hbl.config.vars.theme_path&&!hbl.config.vars.theme_obj){hbl.config.vars.theme_obj=new hbl.themes.default_theme()}},0);var hmpmetrics={};hmpmetrics.track=function(){};function habla_start_func(){if(hbl.post_started){return}hbl.post_started=1;if(hbl.siteid){if(hbl.siteid=="missing-site-id"){hbl.siteid=window.__get_olark_key()}}else{hbl.siteid=window.__get_olark_key()}if(!window.habla_window){habla_window=new hbl._hwindow(hbl.client,hbl.config,hbl.eventmgr);hbl.eventmgr.setWindow(habla_window);habla_window.register_handlers()}if(hbl.config.vars.local_mode){hbl.client.start(hbl.wcsid,hbl.hblid,hbl.siteid,hbl.eventmgr,hbl.config);habla_window.setTheme(hbl.config.vars.theme_obj);habla_window.config.vars.welcome_msg="Hab.la is in testing mode. set <em>config.vars['local_mode'] = false;</em> to go back to normal.";habla_window.config.vars.in_chat_text="Hab.la Local Mode";habla_window.config.vars.before_chat_text="Hab.la Local Mode";habla_window.config.vars.not_available_text="Hab.la Local Mode";habla_window.setHeader(habla_window.config.vars.not_available_text);habla_window.show(1);return}if(hbl.siteid&&hbl.siteid.match(/(olark|\@)/i)&&hbl.config.vars.theme_obj){habla_error({etype:"invalid_site_id"});return}if(!hbl.siteid&&hbl.config.vars.theme_obj){habla_error({etype:"invalid_site_link"});return}hbl.eventmgr.register("habla_error",habla_error,10);hbl.client.start(hbl.wcsid,hbl.hblid,hbl.siteid,hbl.eventmgr,hbl.config);hbl.eventmgr.handle("habla_started")}function habla_error(a){if(a.etype=="invalid_site_id"){hbl.client.eventmgr=new hbl.util.eventmanager();habla_window.setTheme(hbl.config.vars.theme_obj);habla_window.config.vars.offline_message="<em>"+hbl.siteid+"</em> is not a valid <a href='"+hblInstallUrl+"'>"+hblName+"</a> site ID.<p> Your "+hblName+" Site ID is in the format '###-##-###-##' and can be found on your <a href='"+hblInstallUrl+"' target='_blank'>Dashboard</a>.</p>";habla_window.config.vars.not_available_text=hblName+": Site ID Error";habla_window.setHeader(habla_window.config.vars.not_available_text);habla_window.show(1);habla_window.theme.habla_conversation_div.scrollTop=0}else{if(a.etype=="invalid_site_link"){hbl.client.eventmgr=new hbl.util.eventmanager();habla_window.setTheme(hbl.config.vars.theme_obj);habla_window.config.vars.offline_message="Unable to determine your site-id.  Please make sure you have copied and pasted all the code as it appears on your <a href='"+hblInstallUrl+"' target='_blank'>"+hblName+" Dashboard</a>.";habla_window.config.vars.not_available_text=hblName+": Site ID Error";habla_window.setHeader(habla_window.config.vars.not_available_text);habla_window.show(1);habla_window.theme.habla_conversation_div.scrollTop=0}else{if(a.etype=="operator_is_busy"){hbl.client.opbusy=true;habla_window.opbusy=true;habla_window.setWindowText()}}}}function wc_init_post(e){if(window.olark&&window.olark.__legacy_shim){hbl.util.BrowserDetect.init()}if(hbl.config==undefined){hbl.config=new hbl.hconfig()}if(!hbl.config.merge){var a=hbl.config;hbl.config=new hbl.hconfig();hbl.config.merge(a,true)}hbl.wcsid=hbl.config.vars.wcsid||"";hbl.hblid=hbl.config.vars.hblid||"";if(!hbl.config.vars.disable_get_cookies&&!hbl.config.vars.wcsid){hbl.wcsid=hbl.util.get_cookie("wcsid")||"";hbl.hblid=hbl.util.get_cookie("hblid")||""}if(!hbl.config.plugins){hbl.config.plugins=new hbl.util.pluginlist()}e=e||["incoming_notification","googleanalytics","away_div_handler","expand_on_receive_message","google_translate","auto_initiate"];for(var d=0;d<e.length;d++){var b=e[d];var c=new hbl.plugins[b]();hbl.config.plugins.add(c)}hbl.eventmgr.handle("habla_preload_done");habla_start_func()}if(!window.olark||(window.olark&&!window.olark.__legacy_shim)){if(!window.olark||!window.olark.__internal||!window.olark.__internal.skip_wc_init_post){if(!hblJSInline){wc_init_post()}else{hbl.eventmgr.register("habla_called_wc_init",function(a){wc_init_post()})}}}if(window.olark&&window.olark.__internal){window.olark.__internal.declare("__internal.legacy",function(){})}if(window.olark&&window.olark.__legacy_shim){window.olark.__legacy_shim.legacy_post_stub_is_loaded=true};